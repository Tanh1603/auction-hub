# 3.6.1 Evaluate Auction

## 1. Use Case Description

| Field              | Description                                                                                                    |
| ------------------ | -------------------------------------------------------------------------------------------------------------- |
| **Name**           | Evaluate Auction                                                                                               |
| **Description**    | This use case allows the Admin to search Auction Evaluation information in the system based on input keywords. |
| **Actor**          | Admin                                                                                                          |
| **Trigger**        | When Admin clicks on the 'Evaluate' button on the AuctionEvaluationPage screen.                                |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                |
| **Post-condition** | The Auction Evaluation information will be displayed on the AuctionEvaluationPage screen.                      |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "AuctionEvaluationPage" as View
control "FinalizationController" as Controller
control "FinalizationService" as Service
entity "AuctionRepository" as AuctionRepo
entity "BidRepository" as BidRepo

User -> View: Select Auction -> Request Evaluation
View -> Controller: GET /auction-finalization/evaluate/:auctionId
activate Controller

Controller -> Service: evaluateAuction(auctionId, userId)
activate Service

Service -> AuctionRepo: findById(auctionId)
activate AuctionRepo
AuctionRepo --> Service: AuctionEntity
deactivate AuctionRepo

Service -> BidRepo: findValidBidsForAuction(auctionId)
activate BidRepo
BidRepo --> Service: BidEntity[]
deactivate BidRepo

Service -> Service: Perform Evaluation Logic
note right: BR-02, BR-03, BR-04

Service --> Controller: AuctionEvaluationDto
deactivate Service

Controller --> View: 200 OK (JSON)
deactivate Controller

View --> User: Display Evaluation Summary
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin/Auctioneer|
start
:(1) Request Auction Evaluation;

|FinalizationService|
:(2) Authenticate & Authorize;
note right: BR-01

|AuctionRepository|
:(3) Retrieve Auction Details;

|BidRepository|
:(4) Retrieve All Valid Bids for Auction;
note right: Exclude denied bids

|FinalizationService|
if (Auction Not Found?) then (No)
    :(5.1) Return 404 Not Found;
    |Admin/Auctioneer|
    :(5.2) View Error Message;
    stop
endif

if (Auction Not Concluded?) then (No)
    ' Allow evaluation before conclusion for specific cases
endif

|FinalizationService|
:(6) Determine Highest Valid Bid;
note right: BR-03

:(7) Check if Reserve Price Met;
note right: BR-04

:(8) Identify Potential Winning Bidder;

:(9) Calculate Preliminary Financials\n(Fees, commission, payout);
note right: BR-05

:(10) Format Evaluation Summary;
:(11) Return Evaluation Report;

|Admin/Auctioneer|
:(12) Review Auction Evaluation;
stop
@enduml
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                                                                                    |
| :---------- | :-------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**     | **BR-01** | **Displaying Rule (Auction Evaluation Page):**<br>When Admin selects an auction for evaluation, system displays `AuctionEvaluationPage`.<br>System displays auction details, bid summary, and "Get Evaluation" button.                                                                                                                         |
| **(2)**     | **BR-02** | **Validation Rule (Authorization - Back-end):**<br>System checks if requestor role is `admin` or `auctioneer` in `USERS` table.<br>If unauthorized:<br>$\rightarrow$ System displays MSG 5 ("Forbidden") on the View.                                                                                                                          |
| **(3)**     | **BR-03** | **Querying Rule (Auction Data):**<br>System retrieves data from the 'AUCTION' table in the database (Refer to 'AUCTION' table in 'DB Sheet' file) based on the auction ID.<br>If auction not found:<br>$\rightarrow$ System displays MSG 20 ("Auction not found") on the View.<br>System verifies auction has concluded or is near conclusion. |
| **(4)**     | **BR-04** | **Querying Rule (Valid Bids):**<br>System retrieves data from the 'AUCTION_BID' table in the database (Refer to 'AUCTION_BID' table in 'DB Sheet' file) based on the auction ID where bids are not denied.<br>Excludes bids from ineligible participants.                                                                                      |
| **(6)-(9)** | **BR-05** | **Processing Rule (Evaluation Calculation):**<br>System determines highest valid bid from query results.<br>System checks if highest bid meets or exceeds `reservePrice`.<br>System calculates: platform commission, estimated payout, associated fees.                                                                                        |
| **(12)**    | **BR-06** | **Displaying Rule (Evaluation Summary):**<br>System displays evaluation report showing:<br>- Highest valid bid amount<br>- Potential winner (masked identifier)<br>- Reserve price status (Met/Not Met)<br>- Financial summary (commission, fees, payout).                                                                                     |
