# Use Case 3.7.0: Manage Payment

## 1. Use Case Description

| Field              | Content                                                                                                                                   |
| :----------------- | :---------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Manage Payment                                                                                                                            |
| **Description**    | This use case allows the **Bidder** to choose one of the corresponding functions of CRUD to adjust **Payment** information in the system. |
| **Actor**          | **Bidder**, **Winner**, **System**                                                                                                        |
| **Trigger**        | When the **Bidder** clicks on the "**Payment**" button on the navigation sidebar.                                                         |
| **Pre-condition**  | 1. **Bidder**'s device must be connected to the internet.<br>2. **Bidder** is signed in with their account.                               |
| **Post-condition** | The **Payment** information is updated to the corresponding function that the **Bidder** executes.                                        |

---

## 2. Sequence Flow

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder/Winner" as User
boundary "PaymentPage" as View
control "PaymentController" as Controller
control "StripeService" as Stripe
entity "PaymentRepository" as Repo

User -> View: Access Payment Management
View -> Controller: GET /payments
activate Controller
Controller -> Repo: findByUserId()
activate Repo
Repo --> Controller: PaymentList
deactivate Repo
Controller --> View: Return list data
deactivate Controller
View --> User: Display list of Payments

User -> View: Choose function

opt Create Payment Session
    ref over View, Controller, Stripe: Sequence Create Payment Session (3.7.1)
end

opt Verify Payment
    ref over View, Controller, Stripe: Sequence Verify Payment (3.7.2)
end
@enduml
```

---

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Bidder/Winner|
start
:(1) Access Payment Management;
:(2) View Payment List;

|PaymentController|
:(3) Retrieve Payment List;
note right: BR-01

|PaymentRepository|
:(4) Query User Payments;

|Bidder/Winner|
:(5) Display Payment List;
:(6) Choose Function;

if (Which Function?) then (Create Session)
    :(7.1) Go to Create Payment Session;
    note right: Ref: 3.7.1
    stop
else (Verify)
    :(7.2) Go to Verify Payment;
    note right: Ref: 3.7.2
    stop
endif
@enduml
```

---

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                         |
| :------- | :-------- | :-------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(5)**  | **BR-01** | **Displaying Rule:**<br>The system displays a "**Payment Management**" screen. (Refer to "**Payment Management**" view in "View Description" file). |
| **(6)**  | **BR-02** | **Choosing Rule:**<br>**Bidder** can only choose one feature at a time to use.                                                                      |

---

## 5. Related Child Use Cases

| Use Case ID | Use Case Name          | Description                                 |
| :---------- | :--------------------- | :------------------------------------------ |
| 3.7.1       | Create Payment Session | Create a new Stripe payment session         |
| 3.7.2       | Verify Payment         | Verify payment status after Stripe redirect |
