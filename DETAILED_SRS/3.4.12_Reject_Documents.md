# 3.4.12 Reject Documents

## 1. Use Case Description

| Field              | Description                                                                                                                      |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Reject Documents                                                                                                                 |
| **Description**    | This use case allows the Admin to update existing Registration Document information in the system.                               |
| **Actor**          | Admin                                                                                                                            |
| **Trigger**        | When the Admin clicks on the 'Reject Documents' button on the DocumentVerificationPage.                                          |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                                  |
| **Post-condition** | The Registration Document information will be updated in the system and display new record on DocumentVerificationPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "DocumentVerificationPage" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
entity "ParticipantRepository" as ParticipantRepo

User -> View: Review Docs -> Reject (Reason)
View -> Controller: POST /register-to-bid/admin/reject-documents\n{ auctionId, userId, reason }
activate Controller

Controller -> Service: rejectDocuments(auctionId, userId, reason)
activate Service

Service -> ParticipantRepo: findParticipant(auctionId, userId)
activate ParticipantRepo
ParticipantRepo --> Service: ParticipantEntity
deactivate ParticipantRepo

alt Not Found or Wrong Status
    Service --> Controller: Throw NotFound/BadRequest
    Controller --> View: 404/400 Error
    View --> User: Display Error Message
else Found
    ' FIX: Combined message onto one line; used \n for the visual line break
    Service -> ParticipantRepo: updateParticipant({ status: 'DOCUMENTS_REJECTED', \nrejectionReason: reason })
    activate ParticipantRepo
    ParticipantRepo --> Service: UpdatedParticipant
    deactivate ParticipantRepo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (Docs Rejected)
    View --> User: Display Success Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Review Documents;
:(2) Identify Issues;
:(3) Input Rejection Reason;
:(4) Submit Rejection;

|RegistrationService|
:(5) Authenticate & Authorize;
note right: BR-01

:(6) Retrieve Participant Record;

|ParticipantRepository|
:(7) Query Participant;

|RegistrationService|
if (Record Exists?) then (No)
    :(8.1) Return 404 Not Found;
    |Admin|
    :(8.2) View Error Message;
    stop
endif

if (Status is DOCUMENTS_PENDING?) then (No)
    :(9.1) Return 400 Bad Request;
    |Admin|
    :(9.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(10) Update Status to DOCUMENTS_REJECTED;
:(11) Save Reason;
note right: BR-03

|RegistrationService|
:(12) Trigger Notification (To Bidder);
note right: BR-02
:(13) Return Success;

|Admin|
:(14) View Updated Status;
stop
@enduml
```

## 4. Business Rules

| Activity      | BR Code   | Description                                                                                                                                                                                                                                                                                                                             |
| :------------ | :-------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)-(2)**   | **BR-01** | **Displaying Rule (Document Verification Page):**<br>When Admin reviews documents and identifies issues, system displays `DocumentVerificationPage`.<br>System displays document previews and "Reject Documents" button.<br>System displays rejection reason text input field.                                                          |
| **(3)-(4)**   | **BR-02** | **Validation Rule (Input - Front-end):**<br>When Admin enters rejection reason, system uses `Text_change()` method.<br>If `isEmpty(rejectionReason)`:<br>$\rightarrow$ System displays MSG 1 ("Rejection reason is mandatory").<br>On submit, system displays MSG 11 ("Confirm document rejection?").                                   |
| **(5)**       | **BR-03** | **Validation Rule (Authorization - Back-end):**<br>System checks if requestor role is `admin` or `auctioneer` in `USERS` table.<br>If unauthorized:<br>$\rightarrow$ System displays MSG 5 ("Forbidden") on the View.                                                                                                                   |
| **(7)-(8.1)** | **BR-04** | **Validation Rule (Record Existence - Back-end):**<br>System retrieves data from the 'AUCTION_PARTICIPANT' table in the database (Refer to 'AUCTION_PARTICIPANT' table in 'DB Sheet' file) based on the auction ID and user ID.<br>If record not found:<br>$\rightarrow$ System displays MSG 20 ("Registration not found") on the View. |
| **(9.1)**     | **BR-05** | **Validation Rule (Status Pre-requisite - Back-end):**<br>System checks current `status` of participant record.<br>If status is NOT `DOCUMENTS_PENDING`:<br>$\rightarrow$ System displays MSG 16 ("Invalid status for this operation") on the View.                                                                                     |
| **(10)-(11)** | **BR-06** | **Storing Rule:**<br>System saves to `AUCTION_PARTICIPANT` table:<br>- `status = 'DOCUMENTS_REJECTED'`<br>- `rejectionReason = [input reason]`<br>User can resubmit documents after fixing issues.                                                                                                                                      |
| **(12)**      | **BR-07** | **Processing Rule (Notification):**<br>System sends notification to bidder explaining document rejection.<br>Notification includes admin's reason so bidder knows what to fix.                                                                                                                                                          |
| **(14)**      | **BR-08** | **Displaying Rule (Success Confirmation):**<br>System displays MSG 7 ("Documents rejected - awaiting resubmission") on the View.<br>System updates status display to `DOCUMENTS_REJECTED`.                                                                                                                                              |
