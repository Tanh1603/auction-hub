# 3.1.4 Ban User

## 1. Use Case Description

| Field              | Description                                                                                                      |
| ------------------ | ---------------------------------------------------------------------------------------------------------------- |
| **Name**           | Ban User                                                                                                         |
| **Description**    | This use case allows the Admin to update existing User Status information in the system.                         |
| **Actor**          | Admin                                                                                                            |
| **Trigger**        | When the Admin clicks on the 'Ban User' button on the UserManagementPage.                                        |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                  |
| **Post-condition** | The User Status information will be updated in the system and display new record on UserManagementPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as Admin
boundary "UserManagementPage" as View
control "AdminController" as Controller
control "UserService" as Service
database "UserRepository" as Repo

Admin -> View: Click "Ban User" button
View -> Controller: PUT /auth/admin/users/:userId/ban
activate Controller

Controller -> Service: banUser(requestorId, targetUserId)
activate Service

Service -> Repo: findUserById(requestorId)
activate Repo
Repo --> Service: RequestorEntity
deactivate Repo

Service -> Service: Validate Permissions
note right: BR-01, BR-02

alt Target is Higher/Equal Privileged User
    Service --> Controller: Throw ForbiddenException
    Controller --> View: 403 Forbidden
    View --> Admin: Show Error Message
else Valid Request
    Service -> Repo: update(userId, { isBanned: true })
    activate Repo
    Repo --> Service: UpdatedUserEntity
    deactivate Repo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (User Banned)
    View --> Admin: Show Success Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Select User to Ban;
:(2) Confirm Ban Action;

|UserService|
:(3) Receive Ban Request;
:(4) Check Requestor Permissions;

if (Is Requestor Authorized?) then (No)
    :(5.1) Return 403 Forbidden;
    |Admin|
    :(5.2) View Error Message;
    stop
endif

|UserService|
:(6) Retrieve Target User;
if (Target is Super Admin?) then (Yes)
    :(7.1) Return 403 Forbidden;
    note right: BR-02
    |Admin|
    :(7.2) View Error Message;
    stop
endif

|UserRepository|
:(8) Set isBanned = true;

|UserService|
:(9) Return Success;

|Admin|
:(10) Update UI (Show Banned Status);
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules (Confirmation):**<br>❖ The system triggers a confirmation modal by calling `Display_Modal('ConfirmationBox')`. (Refer to “ConfirmationBox” view in “View Description” file).<br>❖ The system displays the message **MSG 11** ("Confirm ban action for user [Name]?").<br>❖ The Admin must select [Confirm] or [Cancel].                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **(2)**  | **BR-02** | **Validation Rules (Back-end):**<br>❖ When the Admin confirms the action, the system calls `UserService.banUser(userId)` to process the request.<br>❖ The system checks the role hierarchy in the table “USERS”.<br>❖ If the input is not valid:<br>⮚ If the [Requestor.role] is lower than or equal to the [Target.role], the system forbids the action.<br>⮚ The system returns a 403 Forbidden status and displays **MSG 6** (Cannot ban superior/peer).                                                                                                                                                                                                                                                                                                                                                                                                            |
| **(8)**  | **BR-03** | **Storing Rules:**<br>❖ If authorized, the system updates the record in the table “USERS” by setting the [isBanned] field to `true`.<br>❖ System moves to step (10) and displays successful notification (Refer to **MSG 7**).<br>❖ The system refreshes the User List to reflect the new status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |