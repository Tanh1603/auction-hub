# 3.8.4 Delete Auction Costs

## 1. Use Case Description

| Field              | Description                                                                                                        |
| ------------------ | ------------------------------------------------------------------------------------------------------------------ |
| **Name**           | Delete Auction Costs                                                                                               |
| **Description**    | This use case allows the Admin to delete a Auction Costs information in the system.                                |
| **Actor**          | Admin                                                                                                              |
| **Trigger**        | When the Admin clicks on the [Icon Delete] button on the right of each item on the AuctionCostPage datagrid.       |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                    |
| **Post-condition** | The Auction Costs information will be removed from the system and display data change on AuctionCostPage datagrid. |

<h2>2. Sequence Flow (MVC)</h2>

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "AuctionCostPage" as View
control "AuctionCostController" as Controller
control "AuctionCostService" as Service
database "AuctionCostRepository" as CostRepo

User -> View: Delete Costs
View -> Controller: DELETE /auction-costs/auction/:auctionId
activate Controller

Controller -> Service: deleteCosts(auctionId, userId)
activate Service

Service -> CostRepo: findByAuctionId(auctionId)
activate CostRepo
CostRepo --> Service: CostsEntity
deactivate CostRepo

alt Costs Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display Error Message
else Costs Found
    Service -> CostRepo: delete(id)
    activate CostRepo
    CostRepo --> Service: Success
    deactivate CostRepo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (Deleted)
    View --> User: View Confirmation
end

deactivate Service
deactivate Controller
@endumal
```

<h2>3. Activities Flow (Swimlanes)</h2>

```plantuml
@startuml
' Use diamond style for cleaner conditionals
skinparam conditionStyle diamond

|Admin|
start
:"(1) Request Cost Deletion";

|AuctionCostService|
:"(2) Authenticate & Authorize";
note right: BR-01

|AuctionCostRepository|
:"(3) Check Existence of Costs";

|AuctionCostService|
' FIX: Quoted the condition string to prevent parsing errors
if ("Costs Found?") then (No)
    :"(4.1) Return 404 Not Found";
    |Admin|
    :"(4.2) View Error Message";
    stop
endif

|AuctionCostRepository|
:"(5) Delete AuctionCost Record";

|AuctionCostService|
:"(6) Return Success";

|Admin|
:"(7) View Confirmation";
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules (Confirmation):**<br>❖ The system displays a confirmation modal, `Display_Modal('ConfirmationBox')`. (Refer to “ConfirmationBox” view in “View Description” file).<br>❖ It presents **MSG 11** ("Delete all costs for auction [Auction Name]?"), requesting explicit confirmation from the Admin.<br>❖ The system provides [Confirm Delete] and [Cancel] options.                                                                                                                                                                                                                                                                                                                                                                                       |
| **(1)**  | **BR-02** | **Authorization Rules (Back-end):**<br>❖ The system checks the authenticated user's role via `AuctionCostService.deleteCosts()`.<br>❖ If the input is not valid:<br>⮚ If the user's role is not 'admin', the system returns a 403 Forbidden status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(5)**  | **BR-03** | **Storing Rules (Back-end):**<br>❖ The system attempts to find the cost record via `AuctionCostRepository.findByAuctionId(auctionId)`.<br>❖ If the input is not valid:<br>⮚ If no record is found, the system returns a 404 Not Found error.<br>❖ If authorized and found, the system deletes the record from the “AUCTION_COST” table.<br>❖ System moves to step (7) and displays successful notification (Refer to **MSG 7**).<br>❖ The system refreshes the costs view to reflect the deletion.                                                                                                                                                                                                                                                                                                                                                                              |
