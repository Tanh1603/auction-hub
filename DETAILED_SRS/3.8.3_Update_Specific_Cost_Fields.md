# 3.8.3 Update Specific Cost Fields

## 1. Use Case Description

| Field              | Description                                                                                                     |
| ------------------ | --------------------------------------------------------------------------------------------------------------- |
| **Name**           | Update Specific Cost Fields                                                                                     |
| **Description**    | This use case allows the Admin to update existing Auction Costs information in the system.                      |
| **Actor**          | Admin                                                                                                           |
| **Trigger**        | When the Admin clicks on the [Icon Edit] button on the right of each item on the EditAuctionCostPage datagrid.  |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                 |
| **Post-condition** | The Auction Costs information will be updated in the system and display new record on AuctionCostPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "EditAuctionCostPage" as View
control "AuctionCostController" as Controller
control "AuctionCostService" as Service
database "AuctionCostRepository" as CostRepo

User -> View: Edit Specific Cost Field
View -> Controller: PATCH /auction-costs/auction/:auctionId\n{ advertisingCost: 5000 }
activate Controller

Controller -> Service: updateSpecificCosts(auctionId, dto, userId)
activate Service

Service -> CostRepo: findByAuctionId(auctionId)
activate CostRepo
CostRepo --> Service: ExistingCosts
deactivate CostRepo

alt Costs Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display Error Message
else Costs Found
    Service -> Service: Merge Changes & Recalculate Total
    note right: BR-02

    Service -> CostRepo: update(id, mergedData)
    activate CostRepo
    CostRepo --> Service: UpdatedCosts
    deactivate CostRepo

    Service --> Controller: AuctionCostResponseDto
    Controller --> View: 200 OK (Updated)
    View --> User: View Updated Costs
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin/Auctioneer|
start
:(1) Select Cost to Modify;
:(2) Input New Value;
:(3) Submit Update;

|AuctionCostService|
:(4) Authenticate & Authorize;
note right: BR-01

|AuctionCostRepository|
:(5) Retrieve Existing Costs;

|AuctionCostService|
if (Record Exists?) then (No)
    :(6.1) Return 404 Not Found;
    |Admin/Auctioneer|
    :(6.2) View Error Message;
    stop
endif

|AuctionCostService|
:(7) Apply Field Updates to In-Memory Object;
:(8) Recalculate `totalCosts`;
note right: BR-02

|AuctionCostRepository|
:(9) Update `AuctionCost` Record;

|AuctionCostService|
:(10) Return Updated Record;

|Admin/Auctioneer|
:(11) View Updated Costs;
stop
@enduml
```

## 4. Business Rules

| Activity      | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------------ | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**       | **BR-01** | **Displaying Rules:**<br>❖ The system renders an “EditAuctionCostPage” for the specific field via `Display_View(costField)`.<br>❖ It displays an input field pre-filled with the current value.<br>❖ A [Save] button is provided to commit the change.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **(2)**       | **BR-02** | **Validation Rules (Front-end):**<br>❖ The system validates the input via `ValidateCostInput(value)`.<br>❖ The value must be numeric and greater than or equal to 0.<br>❖ If the input is not valid:<br>⮚ The system displays **MSG 4** (Cost value cannot be negative).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **(4)**       | **BR-03** | **Authorization Rules (Back-end):**<br>❖ The system checks the authenticated user's role via `AuctionCostService.updateSpecificCosts()`.<br>❖ If the input is not valid:<br>⮚ If the user's role is not 'admin' or 'auctioneer', the system returns a 403 Forbidden status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **(5)-(6.1)** | **BR-04** | **Querying Rules (Back-end):**<br>❖ The system retrieves the existing costs via `AuctionCostRepository.findByAuctionId(auctionId)`.<br>❖ If the input is not valid:<br>⮚ If no cost record is found, the system returns a 404 Not Found error.<br>⮚ It displays **MSG 20** (No cost record exists).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **(7)-(8)**   | **BR-05** | **Processing Rules (Back-end):**<br>❖ The system merges the partial update via `AuctionCostService.mergeAndRecalculate(currentCosts, updates)`.<br>❖ It applies the change to the in-memory object.<br>❖ It then calls `AuctionCostService.calculateTotalCosts()` to update the [totalCosts].                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **(9)**       | **BR-06** | **Storing Rules (Back-end):**<br>❖ The system updates the “AUCTION_COST” table by calling `AuctionCostRepository.update()`.<br>❖ It saves the new field value and the recalculated [totalCosts].<br>❖ System moves to step (11) and displays successful notification (Refer to **MSG 7**).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **(11)**      | **BR-07** | **Displaying Rules (Success):**<br>❖ The system refreshes the summary view via `Refresh_View('AuctionCostSummaryPage')`.<br>❖ It updates the display to reflect the new cost value and the updated total.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |