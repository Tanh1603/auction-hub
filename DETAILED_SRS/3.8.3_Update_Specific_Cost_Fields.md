# 3.8.3 Update Specific Cost Fields

## 1. Use Case Description

| Field              | Description                                                                                                     |
| ------------------ | --------------------------------------------------------------------------------------------------------------- |
| **Name**           | Update Specific Cost Fields                                                                                     |
| **Description**    | This use case allows the Admin to update existing Auction Costs information in the system.                      |
| **Actor**          | Admin                                                                                                           |
| **Trigger**        | When the Admin clicks on the [Icon Edit] button on the right of each item on the EditAuctionCostPage datagrid.  |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                 |
| **Post-condition** | The Auction Costs information will be updated in the system and display new record on AuctionCostPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "EditAuctionCostPage" as View
control "AuctionCostController" as Controller
control "AuctionCostService" as Service
database "AuctionCostRepository" as CostRepo

User -> View: Edit Specific Cost Field
View -> Controller: PATCH /auction-costs/auction/:auctionId\n{ advertisingCost: 5000 }
activate Controller

Controller -> Service: updateSpecificCosts(auctionId, dto, userId)
activate Service

Service -> CostRepo: findByAuctionId(auctionId)
activate CostRepo
CostRepo --> Service: ExistingCosts
deactivate CostRepo

alt Costs Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display Error Message
else Costs Found
    Service -> Service: Merge Changes & Recalculate Total
    note right: BR-02

    Service -> CostRepo: update(id, mergedData)
    activate CostRepo
    CostRepo --> Service: UpdatedCosts
    deactivate CostRepo

    Service --> Controller: AuctionCostResponseDto
    Controller --> View: 200 OK (Updated)
    View --> User: View Updated Costs
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin/Auctioneer|
start
:(1) Select Cost to Modify;
:(2) Input New Value;
:(3) Submit Update;

|AuctionCostService|
:(4) Authenticate & Authorize;
note right: BR-01

|AuctionCostRepository|
:(5) Retrieve Existing Costs;

|AuctionCostService|
if (Record Exists?) then (No)
    :(6.1) Return 404 Not Found;
    |Admin/Auctioneer|
    :(6.2) View Error Message;
    stop
endif

|AuctionCostService|
:(7) Apply Field Updates to In-Memory Object;
:(8) Recalculate `totalCosts`;
note right: BR-02

|AuctionCostRepository|
:(9) Update `AuctionCost` Record;

|AuctionCostService|
:(10) Return Updated Record;

|Admin/Auctioneer|
:(11) View Updated Costs;
stop
@enduml
```

## 4. Business Rules

| Activity      | BR Code   | Description                                                                                                                                                                                                                                                                                                    |
| :------------ | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**       | **BR-01** | **Displaying Rule (Edit Auction Cost Page):**<br>When Admin/Auctioneer selects a cost field to modify, system displays `EditAuctionCostPage`.<br>System pre-populates current value in the editable field.                                                                                                     |
| **(2)**       | **BR-02** | **Validation Rule (Input Field - Front-end):**<br>When Admin inputs new cost value, system triggers `Text_change()` validation.<br>Value must be a non-negative number.<br>If negative:<br>$\rightarrow$ System displays MSG 4 ("Cost value cannot be negative") adjacent to field.                            |
| **(4)**       | **BR-03** | **Validation Rule (Authorization - Back-end):**<br>System checks if requestor role is `admin` or `auctioneer` in `USERS` table.<br>If unauthorized:<br>$\rightarrow$ System displays MSG 5 ("Forbidden") on the View.                                                                                          |
| **(5)-(6.1)** | **BR-04** | **Querying Rule (Existing Record):**<br>System retrieves data from the 'AUCTION_COST' table in the database (Refer to 'AUCTION_COST' table in 'DB Sheet' file) based on the auction ID.<br>If no record found:<br>$\rightarrow$ System displays MSG 20 ("No cost record exists for this auction") on the View. |
| **(7)-(8)**   | **BR-05** | **Processing Rule (Merge & Recalculate):**<br>System merges partial update into existing cost object.<br>System recalculates `totalCosts` field dynamically.                                                                                                                                                   |
| **(9)**       | **BR-06** | **Storing Rule:**<br>System updates `AUCTION_COST` record with merged values and new `totalCosts`.                                                                                                                                                                                                             |
| **(11)**      | **BR-07** | **Displaying Rule (Confirmation):**<br>System displays MSG 7 ("Cost updated successfully") on the View.<br>System displays refreshed cost breakdown with recalculated total.                                                                                                                                   |
