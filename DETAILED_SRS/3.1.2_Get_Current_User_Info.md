# 3.1.2 Get Current User Info

## 1. Use Case Description

| Field              | Description                                                                                             |
| ------------------ | ------------------------------------------------------------------------------------------------------- |
| **Name**           | Get Current User Info                                                                                   |
| **Description**    | This use case allows the User to search User Profile information in the system based on input keywords. |
| **Actor**          | User                                                                                                    |
| **Trigger**        | When User clicks on the 'Profile' button on the UserProfilePage screen.                                 |
| **Pre-condition**  | • User's device must be connected to the internet.<br>• User is signed in with their account.           |
| **Post-condition** | The User Profile information will be displayed on the UserProfilePage screen.                           |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
boundary "UserProfilePage" as View
control "AuthMiddleware" as Middleware
control "AuthController" as Controller
control "AuthService" as Service
database "UserRepository" as Repo

User -> View: Request current user profile
View -> Controller: GET /auth/me (with JWT in Authorization header)
activate Controller

Controller -> Middleware: Intercept Request
activate Middleware
Middleware -> Middleware: Validate JWT Token
note right: BR-01

alt JWT Token is Invalid/Missing
    Middleware --> Controller: 401 Unauthorized
    deactivate Middleware
    Controller --> View: 401 Unauthorized
    View --> User: Display error message
else JWT Token is Valid
    Middleware --> Controller: Request (with user ID from token)
    deactivate Middleware
    Controller -> Service: getCurrentUser(userId)
    activate Service
    Service -> Repo: findUserById(userId)
    activate Repo
    Repo --> Service: UserEntity
    deactivate Repo
    Service --> Controller: UserProfileDto
    deactivate Service
    Controller --> View: 200 OK (UserProfileDto)
    View --> User: Display User Profile
end
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|User|
start
:(1) Request My Profile;

|AuthService|
:(2) Receive Request (GET /auth/me);
:(3) Extract JWT from Authorization Header;

if (JWT Exists and is Valid?) then (No)
    :(4.1) Return 401 Unauthorized;
    note right: BR-01
    |User|
    :(4.2) View Error Message;
    stop
else (Yes)
    |AuthService|
    :(5) Extract User ID from JWT;
    note right: BR-02
    :(6) Query Database for User Profile using ID;
endif

|UserRepository|
:(7) Retrieve User Record;

|AuthService|
:(8) Format User Profile Data;
note right: BR-03
:(9) Return 200 OK with User Profile;

|User|
:(10) Display User Profile;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                         |
| :------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**  | **BR-01** | **Searching Rule:**<br>When user requests profile, system extracts JWT from Authorization header.<br>System validates token via `validateJWT()` method.<br>If token is missing or invalid → display **MSG 4** (Unauthorized), return 401.                                           |
| **(7)**  | **BR-02** | **Querying Rule:**<br>System queries data in the table 'USERS' in the database (Refer to 'USERS' table in 'DB Sheet' file) based on the extracted user ID from JWT token.<br>Call method `displayUserInformation(userData)` to populate profile view.                               |
| **(10)** | **BR-03** | **Displaying Rule:**<br>The system displays a 'UserProfilePage' screen. (Refer to 'UserProfilePage' view in 'View Description' file).<br>Profile data is populated with: email, role, userType, isVerified status.<br>Sensitive fields (password hashes) are excluded from display. |
