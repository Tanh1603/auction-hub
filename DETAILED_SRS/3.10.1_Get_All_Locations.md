# 3.10.1 Get All Locations

## 1. Use Case Description

| Field              | Description                                                                                             |
| ------------------ | ------------------------------------------------------------------------------------------------------- |
| **Name**           | Get All Locations                                                                                       |
| **Description**    | This use case allows any user to retrieve the hierarchical location data (provinces, districts, wards). |
| **Actor**          | All (Public - Guest, Bidder, Auctioneer, Admin)                                                         |
| **Trigger**        | When the user requests `GET /locations` or when location dropdown is loaded on auction forms.           |
| **Pre-condition**  | • User's device must be connected to the internet.                                                      |
| **Post-condition** | The location hierarchy is retrieved and displayed for selection.                                        |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
boundary "AuctionFormPage" as View
control "LocationController" as Controller
control "LocationService" as Service
entity "LocationRepository" as Repo

User -> View: Load Location Dropdown
View -> Controller: GET /locations
activate Controller

Controller -> Service: findAll()
activate Service

Service -> Repo: findAll()
activate Repo
Repo --> Service: Location[]
deactivate Repo

Service -> Service: Build Hierarchy Tree
note right: BR-02

Service --> Controller: LocationHierarchyDto[]
Controller --> View: 200 OK (Locations)
View --> User: Display Location Dropdowns

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|User|
start
:(1) Load Form with Location Fields;

|LocationController|
:(2) Receive Location Request;

|LocationService|
:(3) Query All Locations;

|LocationRepository|
:(4) Fetch from Database;
note right: BR-01

|LocationService|
:(5) Build Parent-Child Hierarchy;
note right: BR-02

:(6) Sort by sortOrder;
note right: BR-03

:(7) Return Hierarchy;

|User|
:(8) View Location Dropdowns;
:(9) Select Province -> District -> Ward;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules (UI):**<br>❖ The system calls `Display_Dropdowns(LocationHierarchyDto)` to render the selection interface.<br>❖ It displays three linked dropdown menus: [Province], [District], and [Ward].<br>❖ Initially, only the [Province] dropdown is enabled, while [District] and [Ward] remain disabled until a parent selection is made.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **(4)**  | **BR-02** | **Querying Rules:**<br>❖ The system invokes `LocationService.findAll()` to retrieve location data.<br>❖ It calls `LocationRepository.findAll()` to fetch records from the “LOCATION” table.<br>❖ The query selects specific fields: [id], [name], [value], [sortOrder], and [parentId] to optimize the payload.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **(5)**  | **BR-03** | **Processing Rules (Hierarchy):**<br>❖ The system constructs the location tree using `LocationService.buildHierarchy(locations)`.<br>❖ It identifies Root Nodes as records where [parentId] is NULL (representing Provinces).<br>❖ It maps Child Nodes (Districts and Wards) to their respective parents based on the [parentId] relationship.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **(6)**  | **BR-04** | **Processing Rules (Sorting):**<br>❖ The system organizes the location data using `LocationService.sortLocations(locations)`.<br>❖ It sorts the list primarily by [sortOrder] in ascending order.<br>❖ If [sortOrder] values are equal, it applies a secondary sort by [name] in ascending alphabetical order.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **(9)**  | **BR-05** | **Validation Rules (Front-end):**<br>❖ When the user changes a selection, the system triggers the `Selection_change()` event.<br>❖ If the input is not valid:<br>⮚ If the [Province] selection changes, the system filters the District list to show only those where [parentId] matches the selected [ProvinceID].<br>⮚ The system then enables the District dropdown for user interaction.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
