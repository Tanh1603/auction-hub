# 3.10.1 Get All Locations

## 1. Use Case Description

| Field              | Description                                                                                             |
| ------------------ | ------------------------------------------------------------------------------------------------------- |
| **Name**           | Get All Locations                                                                                       |
| **Description**    | This use case allows any user to retrieve the hierarchical location data (provinces, districts, wards). |
| **Actor**          | All (Public - Guest, Bidder, Auctioneer, Admin)                                                         |
| **Trigger**        | When the user requests `GET /locations` or when location dropdown is loaded on auction forms.           |
| **Pre-condition**  | • User's device must be connected to the internet.                                                      |
| **Post-condition** | The location hierarchy is retrieved and displayed for selection.                                        |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
boundary "AuctionFormPage" as View
control "LocationController" as Controller
control "LocationService" as Service
entity "LocationRepository" as Repo

User -> View: Load Location Dropdown
View -> Controller: GET /locations
activate Controller

Controller -> Service: findAll()
activate Service

Service -> Repo: findAll()
activate Repo
Repo --> Service: Location[]
deactivate Repo

Service -> Service: Build Hierarchy Tree
note right: BR-02

Service --> Controller: LocationHierarchyDto[]
Controller --> View: 200 OK (Locations)
View --> User: Display Location Dropdowns

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|User|
start
:(1) Load Form with Location Fields;

|LocationController|
:(2) Receive Location Request;

|LocationService|
:(3) Query All Locations;

|LocationRepository|
:(4) Fetch from Database;
note right: BR-01

|LocationService|
:(5) Build Parent-Child Hierarchy;
note right: BR-02

:(6) Sort by sortOrder;
note right: BR-03

:(7) Return Hierarchy;

|User|
:(8) View Location Dropdowns;
:(9) Select Province -> District -> Ward;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                   |
| :------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**  | **BR-01** | **Displaying Rule (Location Dropdowns):**<br>System displays cascading dropdowns for location selection.<br>Fields: Province → District → Ward.<br>Each level filters based on parent selection.                              |
| **(4)**  | **BR-02** | **Querying Rule:**<br>System retrieves data from the 'LOCATION' table in the database.<br>Includes: id, name, value, sortOrder, parentId.<br>Returns all locations in single query for efficiency.                            |
| **(5)**  | **BR-03** | **Processing Rule (Hierarchy Building):**<br>System builds parent-child relationships using `parentId`.<br>Province level: parentId = null.<br>District level: parentId = province.id.<br>Ward level: parentId = district.id. |
| **(6)**  | **BR-04** | **Processing Rule (Sorting):**<br>System sorts locations by `sortOrder` field within each level.<br>Ensures consistent ordering across UI.<br>Alphabetical fallback if sortOrder is equal.                                    |
| **(9)**  | **BR-05** | **Processing Rule (Cascading Selection):**<br>When user selects province, system filters districts.<br>When user selects district, system filters wards.<br>Enables hierarchical address selection.                           |
