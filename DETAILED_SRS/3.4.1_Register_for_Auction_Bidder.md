# 3.4.1 Register for Auction (Bidder)

## 1. Use Case Description

| Field              | Description                                                                                                                  |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Register for Auction (Bidder)                                                                                                |
| **Description**    | This use case allows the Bidder to create a new Auction Registration information in the system.                              |
| **Actor**          | Bidder                                                                                                                       |
| **Trigger**        | When the Bidder clicks on the 'Register for Auction' button on the AuctionRegistrationPage.                                  |
| **Pre-condition**  | • Bidder's device must be connected to the internet.<br>• Bidder is signed in with their account.                            |
| **Post-condition** | The Auction Registration information will be stored into the system and display new record on RegistrationListPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder" as User
boundary "AuctionRegistrationPage" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
entity "AuctionRepository" as AuctionRepo
entity "ParticipantRepository" as ParticipantRepo

User -> View: Click "Register for Auction"
View -> Controller: POST /register-to-bid\n{ auctionId }
activate Controller

Controller -> Service: registerForAuction(auctionId, userId)
activate Service

Service -> AuctionRepo: findById(auctionId)
activate AuctionRepo
AuctionRepo --> Service: AuctionEntity
deactivate AuctionRepo

Service -> Service: Validate Pre-conditions
note right: BR-02, BR-03, BR-04

alt Validation Failed
    Service --> Controller: Throw BadRequestException/ConflictException
    Controller --> View: 400/409 Error
    View --> User: Display Error Message
else Validation Success
    ' FIX: Combined the message into one line or used \n for breaks
    Service -> ParticipantRepo: create({ userId, auctionId, submittedAt: now(), \nstatus: 'DOCUMENTS_PENDING' })
    activate ParticipantRepo
    ParticipantRepo --> Service: newParticipantEntity
    deactivate ParticipantRepo

    Service --> Controller: ParticipantResponseDto
    Controller --> View: 201 Created (Registration Successful)
    View --> User: View Registration Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Bidder|
start
:(1) Initiate Auction Registration;

|RegistrationService|
:(2) Authenticate Requestor;
:(3) Verify Bidder Role;
note right: BR-01

|AuctionRepository|
:(4) Retrieve Auction Details;

|RegistrationService|
if (Auction Exists?) then (No)
    :(5.1) Return 404 Not Found;
    |Bidder|
    :(5.2) View Error Message;
    stop
endif

if (Registration Period Open?) then (No)
    :(6.1) Return 400 Bad Request\n(Registration Closed);
    note right: BR-03
    |Bidder|
    :(6.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(7) Check Existing Registration;
note right: BR-04

|RegistrationService|
if (Already Registered?) then (Yes)
    :(8.1) Return 409 Conflict\n(Already Registered);
    |Bidder|
    :(8.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(9) Create AuctionParticipant Record;
:(10) Set status to DOCUMENTS_PENDING;
note right: BR-05

|RegistrationService|
:(11) Return Success Confirmation;

|Bidder|
:(12) Receive Registration Confirmation;
stop
@enduml
```

## 4. Business Rules



| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |

| **(1)**  | **BR-01** | **Displaying Rules:**<br>❖ The system displays an “AuctionRegistrationPage” screen. (Refer to “AuctionRegistrationPage” view in “View Description” file).<br>❖ The screen renders detailed auction information.<br>❖ It includes a “Register” button and, if applicable, a file upload component for required documents.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

| **(1)**  | **BR-02** | **Validation Rules (Front-end):**<br>❖ The system checks the user's authentication and role via `AuthService.checkRole('bidder')`.<br>❖ If the input is not valid:<br>⮚ If the user is not authenticated, the system redirects to the LoginPage.<br>⮚ If the user’s role is not 'bidder', the system displays **MSG 5** (Forbidden).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

| **(1)**  | **BR-03** | **Validation Rules (Back-end):**<br>❖ When the user clicks the “Register” button, the system calls `RegistrationService.registerForAuction()` to process the request.<br>❖ The system checks the “AUCTION” table for eligibility:<br>⮚ If the [status] is not 'scheduled', the system returns a 400 Bad Request (Auction not scheduled).<br>⮚ If the current time is past [depositEndAt], the system returns a 400 Bad Request (Registration Closed).                                                                                                                                                                                                                                                                                                                                                                                                                        |

| **(10)** | **BR-04** | **Storing Rules (Back-end):**<br>❖ The system first checks the “AUCTION_PARTICIPANT” table for an existing registration.<br>❖ If an existing registration is found, the system returns a 409 Conflict and displays a message indicating that the user is **MSG 12** (Already Registered).<br>❖ Otherwise, a new record is inserted into the “AUCTION_PARTICIPANT” table, setting the [status] to 'DOCUMENTS_PENDING' and recording the `submittedAt` timestamp.<br>❖ System moves to step (12) and displays successful notification (Refer to **MSG 7**).                                                                                                                                                                                                                                                                                         |
