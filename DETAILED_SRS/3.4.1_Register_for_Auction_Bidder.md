# 3.4.1 Register for Auction (Bidder)

## 1. Use Case Description

| Field              | Description                                                                                                                  |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Register for Auction (Bidder)                                                                                                |
| **Description**    | This use case allows the Bidder to create a new Auction Registration information in the system.                              |
| **Actor**          | Bidder                                                                                                                       |
| **Trigger**        | When the Bidder clicks on the 'Register for Auction' button on the AuctionRegistrationPage.                                  |
| **Pre-condition**  | • Bidder's device must be connected to the internet.<br>• Bidder is signed in with their account.                            |
| **Post-condition** | The Auction Registration information will be stored into the system and display new record on RegistrationListPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder" as User
boundary "AuctionRegistrationPage" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
entity "AuctionRepository" as AuctionRepo
entity "ParticipantRepository" as ParticipantRepo

User -> View: Click "Register for Auction"
View -> Controller: POST /register-to-bid\n{ auctionId }
activate Controller

Controller -> Service: registerForAuction(auctionId, userId)
activate Service

Service -> AuctionRepo: findById(auctionId)
activate AuctionRepo
AuctionRepo --> Service: AuctionEntity
deactivate AuctionRepo

Service -> Service: Validate Pre-conditions
note right: BR-02, BR-03, BR-04

alt Validation Failed
    Service --> Controller: Throw BadRequestException/ConflictException
    Controller --> View: 400/409 Error
    View --> User: Display Error Message
else Validation Success
    ' FIX: Combined the message into one line or used \n for breaks
    Service -> ParticipantRepo: create({ userId, auctionId, submittedAt: now(), \nstatus: 'DOCUMENTS_PENDING' })
    activate ParticipantRepo
    ParticipantRepo --> Service: newParticipantEntity
    deactivate ParticipantRepo

    Service --> Controller: ParticipantResponseDto
    Controller --> View: 201 Created (Registration Successful)
    View --> User: View Registration Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Bidder|
start
:(1) Initiate Auction Registration;

|RegistrationService|
:(2) Authenticate Requestor;
:(3) Verify Bidder Role;
note right: BR-01

|AuctionRepository|
:(4) Retrieve Auction Details;

|RegistrationService|
if (Auction Exists?) then (No)
    :(5.1) Return 404 Not Found;
    |Bidder|
    :(5.2) View Error Message;
    stop
endif

if (Registration Period Open?) then (No)
    :(6.1) Return 400 Bad Request\n(Registration Closed);
    note right: BR-03
    |Bidder|
    :(6.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(7) Check Existing Registration;
note right: BR-04

|RegistrationService|
if (Already Registered?) then (Yes)
    :(8.1) Return 409 Conflict\n(Already Registered);
    |Bidder|
    :(8.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(9) Create AuctionParticipant Record;
:(10) Set status to DOCUMENTS_PENDING;
note right: BR-05

|RegistrationService|
:(11) Return Success Confirmation;

|Bidder|
:(12) Receive Registration Confirmation;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**  | **BR-01** | **Displaying Rule:**<br>The system displays a 'AuctionRegistrationPage' screen. (Refer to 'AuctionRegistrationPage' view in 'View Description' file).<br>The screen shows auction details and a 'Register for Auction' button.                                                                                                                                                                                                                                                         |
| **(1)**  | **BR-02** | **Validation Rule (Front-end):**<br>System checks user authentication and role via `checkAuthentication()` method.<br>If not authenticated → redirect to LoginPage.<br>If role is not 'bidder' → display **MSG 5** (Forbidden).                                                                                                                                                                                                                                                        |
| **(1)**  | **BR-03** | **Validation Rule (Back-end/Save):**<br>When user clicks 'Register for Auction' button, send data to database via function `registerForAuction(auctionId, userId)`.<br>Check table `AUCTION` for eligibility (status = 'scheduled', current date < depositEndAt).<br>If not eligible → show **MSG 14** (Registration closed), return 400.<br>Check table `AUCTION_PARTICIPANT` for existing registration.<br>If already registered → show **MSG 12** (Already registered), return 409. |
| **(10)** | **BR-04** | **Storing Rule:**<br>The input data will be checked by table `AUCTION_PARTICIPANT` in the database (Refer to 'AUCTION_PARTICIPANT' table in 'DB Sheet' file) to check if there are any constraints. Else data of the Auction Registration will be stored as a new record in table `AUCTION_PARTICIPANT`.<br>Set status = 'DOCUMENTS_PENDING'.<br>Show **MSG 7** (Success), update view with registration confirmation.                                                                 |
