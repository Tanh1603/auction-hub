# 3.6.5 Get Audit Logs

## 1. Use Case Description

| Field              | Description                                                                                                                                                                                                               |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Get Audit Logs                                                                                                                                                                                                            |
| **Description**    | This use case allows the Admin to search for Audit Logs in the system. This includes status overrides, bid denials, registration approvals/rejections, and finalization events, ensuring accountability and traceability. |
| **Actor**          | Admin, Auctioneer                                                                                                                                                                                                         |
| **Trigger**        | When the Admin navigates to the "Audit Log" tab of an auction, triggering `GET /auction-finalization/audit-logs/:auctionId`.                                                                                              |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account and has `admin` or `auctioneer` role.                                                                                      |
| **Post-condition** | The Audit Logs information will be retrieved and displayed to the Admin in the system, sorted by timestamp (newest first).                                                                                                |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "AuditLogPage" as View
control "FinalizationController" as Controller
control "FinalizationService" as Service
entity "AuditLogRepository" as AuditLogRepo

User -> View: Request Audit Logs
View -> Controller: GET /auction-finalization/audit-logs/:auctionId
activate Controller

Controller -> Service: getAuditLogs(auctionId, userId)
activate Service

Service -> AuditLogRepo: findMany({ where: { auctionId }, orderBy: { createdAt: 'desc' }, include: { user } })
activate AuditLogRepo
AuditLogRepo --> Service: LogEntity[]
deactivate AuditLogRepo

Service --> Controller: AuditLogDto[]
deactivate Service

Controller --> View: 200 OK (JSON)
deactivate Controller

View --> User: Display Audit Timeline
@endumal
```

<h2>3. Activities Flow (Swimlanes)</h2>

```plantuml
@startuml
|Admin/Auctioneer|
start
:(1) Select Auction;
:(2) Open Audit Tab;

|FinalizationService|
:(3) Authenticate & Authorize;
note right: BR-01

|AuditLogRepository|
:(4) Query Audit Logs for Auction;
:(5) Include Actor Details (Name/Role);

|FinalizationService|
:(6) Format Response List;
:(7) Return Logs;

|Admin/Auctioneer|
:(8) Review Action History;
stop
@endumal
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                                                    |
| :---------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)-(2)** | **BR-01** | **Displaying Rule (Audit Log Page):**<br>When Admin opens Audit tab for an auction, system displays `AuditLogPage`.<br>System shows loading indicator while fetching logs.                                                                                                                                     |
| **(3)**     | **BR-02** | **Validation Rule (Authorization - Back-end):**<br>System checks if requestor role is `admin` or `auctioneer` in `USERS` table.<br>If unauthorized:<br>$\rightarrow$ System displays MSG 5 ("Forbidden") on the View.                                                                                          |
| **(4)-(5)** | **BR-03** | **Querying Rule:**<br>System retrieves data from the 'AUCTION_AUDIT_LOG' table in the database (Refer to 'AUCTION_AUDIT_LOG' table in 'DB Sheet' file) based on the auction ID.<br>System orders results by creation date (newest first).<br>System retrieves related User information to display admin names. |
| **(4)**     | **BR-04** | **Processing Rule (Immutability):**<br>Audit logs are read-only records.<br>No API endpoints exist to modify or delete log entries.<br>Preserves data integrity for accountability.                                                                                                                            |
| **(8)**     | **BR-05** | **Displaying Rule (Audit Timeline):**<br>System displays chronological list of audit entries showing:<br>- Action type (STATUS_OVERRIDE, AUCTION_FINALIZED, etc.)<br>- Actor name and role<br>- Timestamp<br>- Reason (if applicable).                                                                         |
