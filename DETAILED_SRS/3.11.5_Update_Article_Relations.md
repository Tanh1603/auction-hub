# 3.11.5 Update Article Relations

## 1. Use Case Description

| Field              | Description                                                                                                             |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Update Article Relations                                                                                                |
| **Description**    | This use case allows the Admin to update the related articles for a specific article.                                   |
| **Actor**          | Admin, Super Admin                                                                                                      |
| **Trigger**        | When the Admin submits related article updates via `PATCH /articles/:id/relations`.                                     |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with admin privileges.<br>• Article exists. |
| **Post-condition** | The article's relations are updated in the database.                                                                    |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "EditArticlePage" as View
control "ArticleController" as Controller
control "ArticleService" as Service
entity "ArticleRelationRepository" as RelationRepo

User -> View: Select Related Articles
View -> Controller: PATCH /articles/:id/relations\n{ relatedIds: [] }
activate Controller

Controller -> Service: updateRelations(id, relatedIds)
activate Service

Service -> Service: Validate Article Exists
Service -> RelationRepo: deleteByArticleId(id)
activate RelationRepo
RelationRepo --> Service: Deleted
deactivate RelationRepo

Service -> RelationRepo: createMany(relations)
activate RelationRepo
RelationRepo --> Service: NewRelations
deactivate RelationRepo

Service --> Controller: ArticleDto
Controller --> View: 200 OK (Updated)
View --> User: Show Success Message

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Open Related Articles Section;
:(2) Select/Deselect Related Articles;
:(3) Submit Relations;

|ArticleController|
:(4) Authenticate & Authorize;
note right: BR-01

|ArticleService|
:(5) Verify Article Exists;

if (Article Found?) then (No)
    :(6.1) Return 404 Not Found;
    |Admin|
    :(6.2) View Error Message;
    stop
endif

|ArticleRelationRepository|
:(7) Delete Existing Relations;
note right: BR-02

:(8) Create New Relations;
note right: BR-03

|ArticleService|
:(9) Return Success Response;

|Admin|
:(10) View Updated Relations;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                           |
| :------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**  | **BR-01** | **Displaying Rule (Relations Section):**<br>System displays searchable/selectable list of other articles.<br>Currently related articles are pre-selected.<br>Admin can select/deselect articles.      |
| **(4)**  | **BR-02** | **Validation Rule (Authorization - Back-end):**<br>System checks if requestor role is `admin` or `super_admin`.<br>If unauthorized:<br>$\rightarrow$ System displays MSG 5 ("Forbidden") on the View. |
| **(7)**  | **BR-03** | **Processing Rule (Replace Strategy):**<br>System uses replace strategy for relations.<br>Deletes all existing relations for the article.<br>Creates new relations from provided IDs.                 |
| **(8)**  | **BR-04** | **Storing Rule:**<br>System saves to `ARTICLE_RELATION` table:<br>- `articleId = [current article]`<br>- `relatedArticleId = [each selected article]`<br>Creates bidirectional links if needed.       |
| **(10)** | **BR-05** | **Displaying Rule (Success Confirmation):**<br>System displays MSG 7 ("Relations updated successfully") on the View.<br>System refreshes related articles section.                                    |
