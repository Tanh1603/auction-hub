# 3.2.3 Forgot Password

## 1. Use Case Description

| Field              | Description                                                                                                        |
| ------------------ | ------------------------------------------------------------------------------------------------------------------ |
| **Name**           | Forgot Password                                                                                                    |
| **Description**    | This use case allows the Guest to create a new Password Reset Request information in the system.                   |
| **Actor**          | Guest                                                                                                              |
| **Trigger**        | When the Guest clicks on the 'Forgot Password' button on the ForgotPasswordPage.                                   |
| **Pre-condition**  | • Guest's device must be connected to the internet.<br>• Guest is on the ForgotPasswordPage.                       |
| **Post-condition** | The Password Reset Request information will be stored into the system and a reset email will be sent to the Guest. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Guest" as User
boundary "ForgotPasswordPage" as View
control "AuthController" as Controller
control "AuthService" as Service
entity "SupabaseService" as Supabase

User -> View: Click "Forgot Password"
User -> View: Enter Email
View -> Controller: POST /auth/forgot-password\n{ email }
activate Controller

Controller -> Service: requestPasswordReset(email)
activate Service

Service -> Supabase: resetPasswordForEmail(email)
activate Supabase

alt Email is not Registered
    Supabase --> Service: Success (for security reasons)
    note right: BR-04
else Email is Registered
    Supabase --> Service: Success
    note right: Supabase handles sending email
end
deactivate Supabase

Service --> Controller: SuccessResponse
Controller --> View: 200 OK (Generic confirmation)
deactivate Service
deactivate Controller

View -> User: Display "Check your email for reset instructions"
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Guest|
start
:(1) Click "Forgot Password";
:(2) Enter Email Address;
:(3) Submit Request;

|AuthService|
:(4) Receive Password Reset Request;
:(5) Validate Email Format;

if (Email Format Invalid?) then (Yes)
    :(6.1) Return 400 Bad Request;
    |Guest|
    :(6.2) View Error Message;
    stop
endif

|AuthService|
:(7) Initiate Password Reset with Supabase;

|SupabaseService|
:(8) Check if Email Exists;

if (Email Does Not Exist?) then (Yes)
    :(9) Log attempt (optional);
    :(10) Return Generic Success;
    note right: BR-04
else (No)
    :(11) Generate Unique, Time-Limited Reset Token;
    :(12) Compose Password Reset Email;
    :(13) Send Email to User;
    note right: BR-02, BR-03
    :(14) Return Success;
endif

|AuthService|
:(15) Return Generic Success Message (200 OK);

|Guest|
:(16) Receive Confirmation to Check Email;
:(17) Check Email Inbox;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                   |
| :------- | :-------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**  | **BR-01** | **Displaying Rule:**<br>The system displays a 'ForgotPasswordPage' screen. (Refer to 'ForgotPasswordPage' view in 'View Description' file).<br>The form contains input field for: email address.                                                                                              |
| **(2)**  | **BR-02** | **Validation Rule (Front-end):**<br>When user enters email, system uses `Text_change()` method.<br>Checks if input is valid (empty, wrong format).<br>If `isEmpty()` on email → display **MSG 1** (Mandatory).<br>If wrong email format → display **MSG 4** (Invalid format).                 |
| **(3)**  | **BR-03** | **Validation Rule (Back-end/Save):**<br>When user clicks 'Reset Password' button, send data to auth provider via function `resetPasswordForEmail(email)`.<br>System internally checks if email exists in database but does NOT reveal result to user (security).                              |
| **(16)** | **BR-04** | **Displaying Rule (Security/Confirmation):**<br>Regardless of whether email exists or not, system displays generic success message: "Check your email for reset instructions".<br>This prevents User Enumeration attacks.<br>If email exists → password reset link is sent via email service. |
