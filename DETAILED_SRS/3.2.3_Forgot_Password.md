# 3.2.3 Forgot Password

## 1. Use Case Description

| Field              | Description                                                                                                        |
| ------------------ | ------------------------------------------------------------------------------------------------------------------ |
| **Name**           | Forgot Password                                                                                                    |
| **Description**    | This use case allows the Guest to create a new Password Reset Request information in the system.                   |
| **Actor**          | Guest                                                                                                              |
| **Trigger**        | When the Guest clicks on the 'Forgot Password' button on the ForgotPasswordPage.                                   |
| **Pre-condition**  | • Guest's device must be connected to the internet.<br>• Guest is on the ForgotPasswordPage.                       |
| **Post-condition** | The Password Reset Request information will be stored into the system and a reset email will be sent to the Guest. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Guest" as User
boundary "ForgotPasswordPage" as View
control "AuthController" as Controller
control "AuthService" as Service
entity "SupabaseService" as Supabase

User -> View: Click "Forgot Password"
User -> View: Enter Email
View -> Controller: POST /auth/forgot-password\n{ email }
activate Controller

Controller -> Service: requestPasswordReset(email)
activate Service

Service -> Supabase: resetPasswordForEmail(email)
activate Supabase

alt Email is not Registered
    Supabase --> Service: Success (for security reasons)
    note right: BR-04
else Email is Registered
    Supabase --> Service: Success
    note right: Supabase handles sending email
end
deactivate Supabase

Service --> Controller: SuccessResponse
Controller --> View: 200 OK (Generic confirmation)
deactivate Service
deactivate Controller

View -> User: Display "Check your email for reset instructions"
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Guest|
start
:(1) Click "Forgot Password";
:(2) Enter Email Address;
:(3) Submit Request;

|AuthService|
:(4) Receive Password Reset Request;
:(5) Validate Email Format;

if (Email Format Invalid?) then (Yes)
    :(6.1) Return 400 Bad Request;
    |Guest|
    :(6.2) View Error Message;
    stop
endif

|AuthService|
:(7) Initiate Password Reset with Supabase;

|SupabaseService|
:(8) Check if Email Exists;

if (Email Does Not Exist?) then (Yes)
    :(9) Log attempt (optional);
    :(10) Return Generic Success;
    note right: BR-04
else (No)
    :(11) Generate Unique, Time-Limited Reset Token;
    :(12) Compose Password Reset Email;
    :(13) Send Email to User;
    note right: BR-02, BR-03
    :(14) Return Success;
endif

|AuthService|
:(15) Return Generic Success Message (200 OK);

|Guest|
:(16) Receive Confirmation to Check Email;
:(17) Check Email Inbox;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules:**<br>❖ The system displays a “ForgotPasswordPage” screen. (Refer to “ForgotPasswordPage” view in “View Description” file).<br>❖ The screen renders an input field for the user's [email] address.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **(2)**  | **BR-02** | **Validation Rules (Front-end):**<br>❖ When the user enters their email, the system uses the `ValidateInput(email)` method for validation.<br>❖ If the input is not valid:<br>⮚ If the [email] field is empty, the system displays **MSG 1** (Mandatory Field).<br>⮚ If the [email] format is invalid, the system displays **MSG 4** (Invalid Format).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **(3)**  | **BR-03** | **Processing Rules (Back-end):**<br>❖ When the user clicks the “Reset Password” button, the system calls `AuthService.requestPasswordReset(email)` to initiate the process.<br>❖ It invokes `Supabase.resetPasswordForEmail(email)` to send the reset email.<br>❖ The system internally checks if the email exists in the database but, for security reasons, does NOT reveal this information to the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **(16)** | **BR-04** | **Displaying Rules (Security/Confirmation):**<br>❖ Regardless of whether the email is registered or not, the system displays a generic success message: "If your email is registered, you will receive reset instructions."<br>❖ This approach prevents user enumeration attacks, enhancing security.<br>❖ If the email exists, a password reset link is sent to the user via the email service.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |