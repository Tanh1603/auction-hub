# 3.3.4 Update Auction

## 1. Use Case Description

| Field              | Description                                                                                                           |
| ------------------ | --------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Update Auction                                                                                                        |
| **Description**    | This use case allows the Auctioneer/Admin to update existing Auction information in the system.                       |
| **Actor**          | Auctioneer/Admin                                                                                                      |
| **Trigger**        | When the Auctioneer/Admin clicks on the [Icon Edit] button on the right of each item on the AuctionListPage datagrid. |
| **Pre-condition**  | • Auctioneer/Admin's device must be connected to the internet.<br>• Auctioneer/Admin is signed in with their account. |
| **Post-condition** | The Auction information will be updated in the system and display new record on AuctionListPage datagrid.             |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Auctioneer/Admin" as User
boundary "EditAuctionPage" as View
control "AuctionController" as Controller
control "AuctionService" as Service
entity "AuctionRepository" as Repo

User -> View: Edit Auction Details
View -> Controller: PUT /auctions/:id\n{ UpdateAuctionDto }
activate Controller

Controller -> Service: update(id, updateDto, userId)
activate Service

Service -> Repo: findUnique(id)
activate Repo
Repo --> Service: existingAuction
deactivate Repo

Service -> Service: Check Status & Permissions
note right: BR-02, BR-03

alt Auction is Live or Ended
    Service --> Controller: Throw BadRequestException
    Controller --> View: 400 Bad Request
    View --> User: Display Error Message
else Auction is Modifiable
    Service -> Service: Validate New Data (Dates, Prices)

    Service -> Repo: update({ where: { id }, data: updateDto })
    activate Repo
    Repo --> Service: updatedAuction
    deactivate Repo

    Service --> Controller: AuctionResponseDto
    Controller --> View: 200 OK (Updated)
    View --> User: Show Success Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Auctioneer/Admin|
start
:(1) Select Auction to Edit;
:(2) Modify Details;
:(3) Submit Update;

|AuctionService|
:(4) Authenticate Requestor;
note right: BR-01

:(5) Retrieve Current Auction State;

|AuctionRepository|
:(6) Query Auction by ID;

|AuctionService|
if (Is Status 'scheduled'?) then (No)
    :(7.1) Return Error (Cannot Edit);
    note right: BR-02
    |Auctioneer/Admin|
    :(7.2) View Error Message;
    stop
endif

|AuctionService|
:(8) Validate Updated Fields;
note right: BR-03

if (Validation Failed?) then (Yes)
    :(9.1) Return Validation Error;
    |Auctioneer/Admin|
    :(9.2) View Error Message;
    stop
endif

|AuctionRepository|
:(10) Update Auction Record;

|AuctionService|
:(11) Return Updated Object;

|Auctioneer/Admin|
:(12) View Updated Details;
stop
@enduml
```

## 4. Business Rules

| Activity  | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 
| :-------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**   | **BR-01** | **Displaying Rules:**<br>❖ The system displays an “EditAuctionPage” screen. (Refer to “EditAuctionPage” view in “View Description” file).<br>❖ The screen is populated with the current auction data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **(2)**   | **BR-02** | **Validation Rules (Front-end):**<br>❖ When the user modifies information, the system performs `ValidateInput(UpdateAuctionDto)` validation, similar to the creation rules.<br>❖ If the input is not valid:<br>⮚ If mandatory fields are empty, the system displays **MSG 1** (Mandatory Field).<br>⮚ If dates are invalid (e.g., [saleStartAt] >= [saleEndAt]), the system displays **MSG 4** (Invalid Timeline).<br>⮚ If prices are negative, the system displays **MSG 4** (Negative Price).                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **(7.1)** | **BR-03** | **State Locking Rules (Back-end):**<br>❖ The system calls `AuctionService.update()` and checks the auction’s [status] in the “AUCTION” table.<br>❖ If the input is not valid:<br>⮚ If the [status] is not 'scheduled' or 'draft' (e.g., 'live', 'ended'), the system returns a 400 Bad Request.<br>⮚ The system displays **MSG 13** (Cannot edit active auction) to the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **(3)**   | **BR-04** | **Storing Rules (Back-end):**<br>❖ When the user clicks “Save Changes”, the system calls `AuctionService.update(id, updateAuctionDto)` to update the record in the “AUCTION” table where the [id] matches.<br>❖ The `updatedAt` timestamp is set to the current time.<br>❖ System moves to step (12) and displays successful notification (Refer to **MSG 7**).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

```

```
