# 3.6.4 Get Auction Results

## 1. Use Case Description

| Field              | Description                                                                                                                                                                   |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Get Auction Results                                                                                                                                                           |
| **Description**    | This use case allows the User to search for Auction Results in the system. This includes the final sale price, the winning bidder (anonymized), and the total number of bids. |
| **Actor**          | All Authenticated Users (Participants, Guests)                                                                                                                                |
| **Trigger**        | When the User navigates to a "Results" page or requests `GET /auction-finalization/results/:auctionId`.                                                                       |
| **Pre-condition**  | • User's device must be connected to the internet.<br>• User is signed in with their account.                                                                                 |
| **Post-condition** | The Auction Results information will be retrieved and displayed to the User in the system.                                                                                    |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
boundary "AuctionResultsPage" as View
control "FinalizationController" as Controller
control "FinalizationService" as Service
entity "AuctionRepository" as AuctionRepo

User -> View: Request Auction Results
View -> Controller: GET /auction-finalization/results/:auctionId
activate Controller

Controller -> Service: getAuctionResults(auctionId)
activate Service

Service -> AuctionRepo: findById(auctionId)
activate AuctionRepo
AuctionRepo --> Service: AuctionEntity
deactivate AuctionRepo

alt Auction Not Finalized
    Service --> Controller: Throw BadRequestException
    Controller --> View: 400 Bad Request
    View --> User: Display Error Message
else Auction Finalized
    Service -> Service: Filter/Anonymize Data
    note right: BR-02
    Service --> Controller: AuctionResultDto
    Controller --> View: 200 OK (Results)
    View --> User: Display Results
end

deactivate Service
deactivate Controller
@endumal
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|User|
start
:(1) View Auction Page;
:(2) Request Results;

|FinalizationService|
:(3) Authenticate Requestor;

|AuctionRepository|
:(4) Retrieve Auction Details;

|FinalizationService|
if (Status in [success, failed]?) then (No)
    :(5.1) Return Error (Results not available);
    note right: BR-01
    |User|
    :(5.2) View Error Message;
    stop
endif

:(6) Prepare Result Data;
:(7) Mask Winner Identity;
note right: BR-02

:(8) Return Public Result DTO;

|User|
:(9) View Final Price & Outcome;
stop
@endumal
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :---------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)-(2)** | **BR-01** | **Displaying Rules:**<br>❖ The system displays an “AuctionResultsPage” via `Display_View()`.<br>❖ It initially shows a loading skeleton while data is being fetched.<br>❖ The Results Container is rendered but remains hidden until the data is ready.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(3)**     | **BR-02** | **Authentication Rules:**<br>❖ The system performs access control via `AuthGuard.canActivate()`.<br>❖ It ensures the user has a valid JWT token.<br>❖ Guests may be allowed access if the view is public; otherwise, only authenticated users can proceed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **(4)**     | **BR-03** | **Querying Rules:**<br>❖ The system calls `FinalizationService.getAuctionResults(auctionId)` to retrieve the data.<br>❖ It queries the “AUCTION” table by ID.<br>❖ The query includes the related “AUCTION_BID” to identify the Winning Bid.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **(5.1)**   | **BR-04** | **State Locking Rules (Back-end):**<br>❖ The system verifies the auction state via `AuctionService.isFinalized(auction)`.<br>❖ If the input is not valid:<br>⮚ If the [status] is not 'success' or 'failed', the system returns a 400 Bad Request.<br>⮚ The system displays **MSG 26** (Results not available) to the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **(7)**     | **BR-05** | **Privacy Rules (Back-end):**<br>❖ The system applies privacy masking via `FinalizationService.anonymizeWinner(user)`.<br>❖ It masks the [fullName] (e.g., "Bidder ***123") and [email] (e.g., "b***@email.com").<br>❖ Only the masked data is returned in the DTO to protect user privacy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **(9)**     | **BR-06** | **Displaying Rules (Data):**<br>❖ The system renders the results card using `Display_Results_Card(results)`.<br>❖ It displays the [FinalPrice] and the masked [Winner] identity.<br>❖ It shows the total count of bids as [TotalBids].<br>❖ An [Outcome] badge (Success/Failed) is displayed to indicate the auction result.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
