# 3.5.8 Receive Bid Denied Notification

## 1. Use Case Description

| Field              | Description                                                                                                          |
| ------------------ | -------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Receive Bid Denied Notification                                                                                      |
| **Description**    | This use case allows the Bidder to search Bid Denied Notification information in the system based on input keywords. |
| **Actor**          | Bidder                                                                                                               |
| **Trigger**        | When an Admin denies a bid in the auction room.                                                                      |
| **Pre-condition**  | • Bidder's device must be connected to the internet.<br>• Bidder is signed in with their account.                    |
| **Post-condition** | The Bid Denied Notification information will be displayed on the AuctionDetailPage screen.                           |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder" as User
control "BiddingService" as Service
control "WebSocketGateway" as WSGateway
boundary "WebSocketClient" as WSClient
boundary "AuctionDetailPage" as View

Service -> Service: Bid Denied Successfully (see UC 3.5.2)
Service -> WSGateway: emitBidDeniedNotification(bidderId, auctionId, reason)
activate WSGateway

WSGateway -> WSGateway: Identify Socket(s) for Bidder ID
note right: BR-01

WSGateway --> WSClient: Emit `bidDenied` (BidDeniedDto)
WSClient -> View: Trigger Notification Alert
View --> User: Observe "Bid Denied" Message
deactivate WSGateway
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|BiddingService|
start
:(1) Bid Denied Action Completed;

|WebSocketGateway|
:(2) Prepare `bidDenied` Event Payload;
note right: BR-02

:(3) Identify Target Bidder's Connection;
note right: BR-01

:(4) Emit `bidDenied` Event to Specific Client;

|Bidder|
:(5) Receive `bidDenied` Event;
:(6) Parse Denial Reason;
:(7) Display Notification to User;
:(8) Update Bid Status in UI (if visible);
:(9) Acknowledge Denial;
stop
@endumal
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :---------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**     | **BR-01** | **Processing Rules (Denial Trigger):**<br>❖ The system initiates this workflow via `BiddingService.denyBid()`.<br>❖ It is triggered immediately after an Admin or Auctioneer updates a record in the “AUCTION_BID” table with [isDenied] set to `true`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **(2)**     | **BR-02** | **Processing Rules (Payload Preparation):**<br>❖ The system constructs the notification payload via `Create_BidDenied_Payload(bid, reason)`.<br>❖ The payload includes the [auctionId], the denied [bidAmount], the [denialReason], and the specific [bidId].                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **(3)**     | **BR-03** | **Processing Rules (Targeted Delivery):**<br>❖ The system identifies the target connection using `WebSocketGateway.getUserSocket(bidderId)`.<br>❖ It looks up the active WebSocket for the specific [bidderId].<br>❖ The notification is sent via Unicast only to this user to protect the bidder's privacy and avoid public shaming.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **(4)**     | **BR-04** | **Processing Rules (Broadcasting):**<br>❖ The system emits the event by calling `WebSocketGateway.emit('bidDenied', payload)`.<br>❖ It sends the `bidDenied` event immediately to the targeted socket to ensure prompt feedback.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **(5)-(9)** | **BR-05** | **Displaying Rules (Denial Alert):**<br>❖ Upon receiving the event, the client triggers `Display_Notification('Error', message)`.<br>❖ It displays a Toast or Alert message: "Your bid of [Amount] was denied. Reason: [Reason]".<br>❖ The system updates the Bid History UI to visually indicate the denied status (e.g., strikethrough).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |