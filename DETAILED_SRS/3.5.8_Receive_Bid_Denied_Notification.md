# 3.5.8 Receive Bid Denied Notification

## 1. Use Case Description

| Field              | Description                                                                                                          |
| ------------------ | -------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Receive Bid Denied Notification                                                                                      |
| **Description**    | This use case allows the Bidder to search Bid Denied Notification information in the system based on input keywords. |
| **Actor**          | Bidder                                                                                                               |
| **Trigger**        | When an Admin denies a bid in the auction room.                                                                      |
| **Pre-condition**  | • Bidder's device must be connected to the internet.<br>• Bidder is signed in with their account.                    |
| **Post-condition** | The Bid Denied Notification information will be displayed on the AuctionDetailPage screen.                           |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder" as User
control "BiddingService" as Service
control "WebSocketGateway" as WSGateway
boundary "WebSocketClient" as WSClient
boundary "AuctionDetailPage" as View

Service -> Service: Bid Denied Successfully (see UC 3.5.2)
Service -> WSGateway: emitBidDeniedNotification(bidderId, auctionId, reason)
activate WSGateway

WSGateway -> WSGateway: Identify Socket(s) for Bidder ID
note right: BR-01

WSGateway --> WSClient: Emit `bidDenied` (BidDeniedDto)
WSClient -> View: Trigger Notification Alert
View --> User: Observe "Bid Denied" Message
deactivate WSGateway
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|BiddingService|
start
:(1) Bid Denied Action Completed;

|WebSocketGateway|
:(2) Prepare `bidDenied` Event Payload;
note right: BR-02

:(3) Identify Target Bidder's Connection;
note right: BR-01

:(4) Emit `bidDenied` Event to Specific Client;

|Bidder|
:(5) Receive `bidDenied` Event;
:(6) Parse Denial Reason;
:(7) Display Notification to User;
:(8) Update Bid Status in UI (if visible);
:(9) Acknowledge Denial;
stop
@endumal
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                       |
| :---------- | :-------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**     | **BR-01** | **Processing Rule (Denial Trigger):**<br>When bid is denied by Admin/Auctioneer (Use Case 3.5.2):<br>$\rightarrow$ System triggers `bidDenied` notification to specific bidder.                                                                                                   |
| **(2)**     | **BR-02** | **Processing Rule (Payload Preparation):**<br>System prepares `bidDenied` event payload with:<br>- `auctionId`<br>- `bidAmount` that was denied<br>- `denialReason` explaining why bid was invalid.                                                                               |
| **(3)**     | **BR-03** | **Processing Rule (Targeted Delivery - Privacy):**<br>System sends `bidDenied` notification only to the specific bidder whose bid was denied.<br>Not broadcast to entire auction room to maintain privacy.<br>System identifies target socket by bidder userId.                   |
| **(4)**     | **BR-04** | **Processing Rule (Immediate Feedback):**<br>Notification delivered immediately after denial processing.<br>Allows bidder to react promptly and place new compliant bid if desired.                                                                                               |
| **(5)-(9)** | **BR-05** | **Displaying Rule (Denial Alert):**<br>Client receives `bidDenied` event via WebSocket.<br>Client displays alert/notification: "Your bid of [amount] was denied: [reason]".<br>Client updates bid history to show denied status.<br>User acknowledges denial and can take action. |
