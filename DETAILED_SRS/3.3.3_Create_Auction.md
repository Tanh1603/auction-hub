# 3.3.3 Create Auction

## 1. Use Case Description

| Field              | Description                                                                                                           |
| ------------------ | --------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Create Auction                                                                                                        |
| **Description**    | This use case allows the Auctioneer/Admin to create a new Auction information in the system.                          |
| **Actor**          | Auctioneer/Admin                                                                                                      |
| **Trigger**        | When the Auctioneer/Admin clicks on the 'Create Auction' button on the CreateAuctionPage.                             |
| **Pre-condition**  | • Auctioneer/Admin's device must be connected to the internet.<br>• Auctioneer/Admin is signed in with their account. |
| **Post-condition** | The Auction information will be stored into the system and display new record on AuctionListPage datagrid.            |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Auctioneer/Admin" as User
boundary "CreateAuctionPage" as View
control "AuctionController" as Controller
control "AuctionService" as Service
database "AuctionRepository" as Repo

User -> View: Fill Auction Details Form
View -> Controller: POST /auctions\n{ CreateAuctionDto }
activate Controller

Controller -> Service: create(createAuctionDto, userId)
activate Service

Service -> Service: Validate DTO (Dates, Prices)
note right: BR-03, BR-04

Service -> Repo: findByCode(dto.code)
activate Repo
Repo --> Service: existingAuction (or null)
deactivate Repo

alt Code Already Exists
    Service --> Controller: Throw ConflictException
    Controller --> View: 409 Conflict
    View --> User: Display Error Message
else Code is Unique
    Service -> Repo: create({ ...dto, status: 'scheduled' })
    activate Repo
    Repo --> Service: NewAuctionEntity
    deactivate Repo

    Service --> Controller: AuctionResponseDto
    Controller --> View: 201 Created
    View --> User: Show Success Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Auctioneer/Admin|
start
:(1) Input Auction Details;
:(2) (Code, Name, Dates, Prices);
:(3) Submit Creation Request;

|AuctionService|
:(4) Authenticate & Authorize;
note right: BR-01

if (Authorized?) then (No)
    :(5.1) Return 403 Forbidden;
    |Auctioneer/Admin|
    :(5.2) View Error Message;
    stop
endif

|AuctionService|
:(6) Validate Input Data;
note right: BR-03, BR-04

if (Validation Failed?) then (Yes)
    :(7.1) Return 400 Bad Request;
    |Auctioneer/Admin|
    :(7.2) View Error Message;
    stop
endif

|AuctionService|
:(8) Check Code Uniqueness;
note right: BR-02

|AuctionRepository|
:(9) Query for Existing Code;

if (Code Exists?) then (Yes)
    |AuctionService|
    :(10.1) Return 409 Conflict;
    |Auctioneer/Admin|
    :(10.2) View Error Message;
    stop
endif

|AuctionRepository|
:(11) Insert New Auction Record;
:(12) Set Initial Status to 'scheduled';
note right: BR-05

|AuctionService|
:(13) Return Success Response;

|Auctioneer/Admin|
:(14) Receive New Auction ID;
:(15) View Created Auction;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules:**<br>❖ The system displays a “CreateAuctionPage” screen. (Refer to “CreateAuctionPage” view in “View Description” file).<br>❖ The screen renders input fields for: [Code], [Name], [Description], [Dates] (saleStart, saleEnd, auctionStart, auctionEnd), and [Pricing] (startingPrice, bidIncrement, depositAmount).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **(2)**  | **BR-02** | **Validation Rules (Front-end):**<br>❖ When the user enters information, the system performs `Text_change()` validation.<br>❖ If the input is not valid:<br>⮚ If [Code] or [Name] is empty, the system displays **MSG 1** (Mandatory Field).<br>⮚ If [saleStartAt] is greater than or equal to [saleEndAt], the system displays **MSG 4** (Invalid Timeline).<br>⮚ If [startingPrice] is negative, the system displays **MSG 4** (Negative Price).                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **(3)**  | **BR-03** | **Validation Rules (Back-end):**<br>❖ When the user clicks the “Create Auction” button, the system calls `AuctionService.create()` to process the data.<br>❖ The system checks the “AUCTION” table for uniqueness of the [code].<br>❖ If the input is not valid:<br>⮚ If the [code] already exists, the system returns a 409 Conflict and displays **MSG 12** (Duplicate Code).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(12)** | **BR-04** | **Storing Rules (Back-end):**<br>❖ Upon successful validation, the system inserts a new record into the “AUCTION” table via `AuctionService.create(createAuctionDto)`.<br>❖ The [status] is set to 'scheduled', and the `createdAt` timestamp is recorded.<br>❖ System moves to step (14) and displays successful notification (Refer to **MSG 7**).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
