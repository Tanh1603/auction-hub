# 3.1.5 Verify User Identity (KYC)

## 1. Use Case Description

| Field              | Description                                                                                                              |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| **Name**           | Verify User Identity (KYC)                                                                                               |
| **Description**    | This use case allows the Admin to update existing User Verification information in the system.                           |
| **Actor**          | Admin                                                                                                                    |
| **Trigger**        | When the Admin clicks on the 'Verify Identity' button on the UserVerificationPage.                                       |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                          |
| **Post-condition** | The User Verification information will be updated in the system and display new record on UserVerificationPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as Admin
boundary "UserVerificationPage" as View
control "AdminController" as Controller
control "UserService" as Service
database "UserRepository" as Repo

Admin -> View: Review User Documents
Admin -> View: Click "Verify Identity"
View -> Controller: PUT /auth/admin/users/:userId/verify
activate Controller

Controller -> Service: verifyUserIdentity(userId)
activate Service

Service -> Repo: findUserById(userId)
activate Repo
Repo --> Service: UserEntity
deactivate Repo

Service -> Service: Check Current Status

alt Already Verified
    Service --> Controller: Throw BadRequestException
    Controller --> View: 400 Bad Request
    View --> Admin: Show Error Message
else Not Verified
    Service -> Repo: update(userId, { isVerified: true })
    activate Repo
    Repo --> Service: UpdatedUserEntity
    deactivate Repo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (User Verified)
    View --> Admin: Show Success Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Review Submitted KYC Docs;
:(2) Decide to Verify;

|UserService|
:(3) Receive Verification Request;
:(4) Check Admin Permissions;

if (Authorized?) then (No)
    :(5.1) Return 403 Forbidden;
    |Admin|
    :(5.2) View Error Message;
    stop
endif

|UserService|
:(6) Check Target User Status;
note right: BR-02

if (Already Verified?) then (Yes)
    :(7.1) Return 400 Bad Request;
    |Admin|
    :(7.2) View Error Message;
    stop
endif

|UserRepository|
:(8) Set isVerified = true;

|UserService|
:(9) Trigger Notification (Optional);
:(10) Return Success;

|Admin|
:(11) View Updated Status;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules:**<br>❖ The system renders the “UserVerificationPage” screen for the specified user via `Display_View(userId)`.<br>❖ It queries the “USERS” table by ID to retrieve the user's data.<br>❖ The system displays a preview area containing the [identityNumber] and [identityImages] submitted by the user, along with their current verification status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **(6)**  | **BR-02** | **Validation Rules (Front-end):**<br>❖ The system performs a status check using `checkVerificationStatus()` before enabling actions.<br>❖ If the input is not valid:<br>⮚ If the user's [isVerified] status is already `true`, the system disables the “Verify Identity” button.<br>⮚ The system displays **MSG 9** (User already verified) to inform the admin.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **(8)**  | **BR-03** | **Storing Rules (Back-end):**<br>❖ When the Admin confirms verification, the system invokes `AdminService.verifyUserIdentity(userId)`.<br>❖ The system checks the current status in the “USERS” table.<br>❖ If the input is not valid:<br>⮚ If the user is already verified, it returns a 400 Bad Request error.<br>❖ Otherwise, the system updates the record in the “USERS” table, setting [isVerified] to `true`.<br>❖ System moves to step (9) and triggers a notification to the user.<br>❖ The system displays **MSG 7** (Success) on the screen.                                                                                                                                                                                                                                                                                          |
