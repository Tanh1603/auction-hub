# 3.9.1 Get All System Variables

## 1. Use Case Description

| Field              | Description                                                                                                     |
| ------------------ | --------------------------------------------------------------------------------------------------------------- |
| **Name**           | Get All System Variables                                                                                        |
| **Description**    | This use case allows the Admin to retrieve all system configuration variables or filter by category.            |
| **Actor**          | Admin, Super Admin                                                                                              |
| **Trigger**        | When the Admin navigates to the "System Configuration" page or requests `GET /system-variables`.                |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with `admin` or `super_admin` role. |
| **Post-condition** | The system configuration variables are retrieved and displayed to the Admin.                                    |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "SystemConfigPage" as View
control "SystemVariablesController" as Controller
control "SystemVariablesService" as Service
entity "SystemVariableRepository" as Repo

User -> View: Navigate to System Configuration
View -> Controller: GET /system-variables?category=xxx
activate Controller

Controller -> Service: getAll(category?)
activate Service

Service -> Repo: findAll(category?)
activate Repo
Repo --> Service: SystemVariable[]
deactivate Repo

Service --> Controller: SystemVariablesDto[]
Controller --> View: 200 OK (Variables)
View --> User: Display Variables List

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Navigate to System Configuration;

|SystemVariablesController|
:(2) Authenticate & Authorize;
note right: BR-01

if (Authorized?) then (No)
    :(3.1) Return 403 Forbidden;
    |Admin|
    :(3.2) View Error Message;
    stop
endif

|SystemVariablesService|
:(4) Check for Category Filter;

|SystemVariableRepository|
:(5) Query Variables from Database;
note right: BR-02

|SystemVariablesService|
:(6) Format Response Data;

|Admin|
:(7) View System Variables;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules:**<br>❖ The system renders the “SystemConfigPage” via `Display_View()`.<br>❖ It provides a dropdown to filter variables by [Category].<br>❖ A data table is rendered showing: [Key], [Value], [DataType], [Description], and an [IsActive] status indicator.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **(2)**  | **BR-02** | **Authorization Rules (Back-end):**<br>❖ The system calls `SystemVariablesService.getAll()` and verifies the user's role.<br>❖ If the input is not valid:<br>⮚ If the user's role is not 'admin' or 'super_admin', the system returns a 403 Forbidden status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **(4)**  | **BR-03** | **Querying Rules:**<br>❖ The system invokes `SystemVariableRepository.findAll(category)` to fetch the data.<br>❖ It queries the “SYSTEM_VARIABLE” table.<br>❖ If a [category] filter is provided, the query includes a WHERE clause (`WHERE [category] = filter`).<br>❖ The results are ordered by [category] and [key].                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **(5)**  | **BR-04** | **Processing Rules (Cache):**<br>❖ The system first attempts to retrieve variables from the cache via `CacheService.get('systemVariables', category)`.<br>❖ If the data is available in the cache, it is returned immediately.<br>❖ If not, the system queries the database and stores the result in the cache for future requests.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(7)**  | **BR-05** | **Displaying Rules (Data Table):**<br>❖ The system renders the results via `Display_DataTable('SystemVariables', data)`.<br>❖ It formats the [Value] based on the [DataType] (e.g., displaying booleans as checkboxes, formatting JSON strings).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
