# 3.9.2 Get System Variable

## 1. Use Case Description

| Field              | Description                                                                                                     |
| ------------------ | --------------------------------------------------------------------------------------------------------------- |
| **Name**           | Get System Variable                                                                                             |
| **Description**    | This use case allows the Admin to retrieve a specific system configuration variable by category and key.        |
| **Actor**          | Admin, Super Admin                                                                                              |
| **Trigger**        | When the Admin requests `GET /system-variables/:category/:key`.                                                 |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with `admin` or `super_admin` role. |
| **Post-condition** | The specific system configuration variable is retrieved and displayed to the Admin.                             |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "SystemConfigPage" as View
control "SystemVariablesController" as Controller
control "SystemVariablesService" as Service
entity "SystemVariableRepository" as Repo

User -> View: Request Specific Variable
View -> Controller: GET /system-variables/:category/:key
activate Controller

Controller -> Service: get(category, key)
activate Service

Service -> Repo: findByKey(category, key)
activate Repo
Repo --> Service: SystemVariable (or null)
deactivate Repo

alt Variable Found
    Service --> Controller: VariableDto
    Controller --> View: 200 OK (Variable)
    View --> User: Display Variable Value
else Variable Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display Error Message
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Request Specific Variable;

|SystemVariablesController|
:(2) Authenticate & Authorize;
note right: BR-01

|SystemVariablesService|
:(3) Check Cache for Variable;
note right: BR-02

if (In Cache?) then (Yes)
    :(4.1) Return Cached Value;
else (No)
    |SystemVariableRepository|
    :(4.2) Query Database;

    |SystemVariablesService|
    :(5) Update Cache;
endif

|SystemVariablesService|
if (Variable Found?) then (No)
    :(6.1) Return 404 Not Found;
    |Admin|
    :(6.2) View Error Message;
    stop
endif

:(7) Return Variable Value;

|Admin|
:(8) View Variable Details;
stop
@enduml
```

## 4. Business Rules

| Activity  | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :-------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**   | **BR-01** | **Displaying Rules:**<br>❖ The system displays a “SystemVariableDetailsPage” via `Display_View()`.<br>❖ It renders read-only fields for: [Category], [Key], [Value], [DataType], and [Description].                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(2)**   | **BR-02** | **Authorization Rules (Back-end):**<br>❖ The system calls `SystemVariablesService.get()` and checks the user's role.<br>❖ If the input is not valid:<br>⮚ If the user's role is not 'admin' or 'super_admin', the system returns a 403 Forbidden status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **(3)**   | **BR-03** | **Processing Rules (Cache):**<br>❖ The system attempts to fetch the specific variable from the cache via `CacheService.get('systemVariable', category, key)`.<br>❖ If found, the cached value is returned immediately.<br>❖ If not found, the system proceeds to query the database and updates the cache with the result.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **(4.2)** | **BR-04** | **Querying Rules:**<br>❖ The system queries the “SYSTEM_VARIABLE” table using `SystemVariableRepository.findByKey(category, key)`.<br>❖ If the input is not valid:<br>⮚ If the variable is not found, the system returns a 404 Not Found error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **(7)**   | **BR-05** | **Displaying Rules (Data):**<br>❖ The system formats the displayed value using `Display_Formatted_Value(value, dataType)`.<br>❖ It ensures appropriate formatting based on the [dataType] (e.g., "true"/"false" strings for booleans, pretty-printed JSON for objects).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |