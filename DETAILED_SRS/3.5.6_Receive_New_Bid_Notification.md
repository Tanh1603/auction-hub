# 3.5.6 Receive New Bid Notification

## 1. Use Case Description

| Field              | Description                                                                                                 |
| ------------------ | ----------------------------------------------------------------------------------------------------------- |
| **Name**           | Receive New Bid Notification                                                                                |
| **Description**    | This use case allows the User to search Bid Notification information in the system based on input keywords. |
| **Actor**          | User                                                                                                        |
| **Trigger**        | When a new bid is placed in the auction room.                                                               |
| **Pre-condition**  | • User's device must be connected to the internet.<br>• User is signed in with their account.               |
| **Post-condition** | The Bid Notification information will be displayed on the AuctionDetailPage screen.                         |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
control "BiddingService" as Service
entity "BidRepository" as BidRepo
entity "AuctionRepository" as AuctionRepo
control "WebSocketGateway" as WSGateway
boundary "WebSocketClient" as WSClient
boundary "AuctionDetailPage" as View

Service -> BidRepo: Bid Placed
activate BidRepo
BidRepo --> Service: NewBidEntity
deactivate BidRepo

Service -> AuctionRepo: Auction Updated
activate AuctionRepo
AuctionRepo --> Service: UpdatedAuction
deactivate AuctionRepo

Service -> WSGateway: emitNewBidNotification(auctionId, newBidDetails)
activate WSGateway

WSGateway -> WSGateway: Broadcast `newBid` to room (auctionId)
note right: BR-01, BR-02

WSGateway --> WSClient: Emit `newBid` (NewBidDto)
WSClient -> View: Update UI with NewBidDto
View --> User: Observe New Highest Bid
deactivate WSGateway
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|BiddingService|
start
:(1) New Valid Bid Processed;

|AuctionRepository|
:(2) Auction Highest Bid Updated;

|WebSocketGateway|
:(3) Prepare `newBid` Event Payload;
note right: BR-02, BR-04

:(4) Broadcast `newBid` Event;
note right: BR-01

|User|
:(5) Receive `newBid` Event;
:(6) Parse New Bid Data;
:(7) Update Bid Display in UI;
:(8) Observe New Highest Bid;
stop
@endumal
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                        |
| :---------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)-(2)** | **BR-01** | **Processing Rule (Bid Trigger):**<br>When new valid bid is processed and saved to `AUCTION_BID` table:<br>$\rightarrow$ System triggers `newBid` broadcast to auction room.                                                                       |
| **(3)**     | **BR-02** | **Processing Rule (Payload Preparation):**<br>System prepares `newBid` event payload with:<br>- New highest bid amount<br>- Masked bidder identifier (e.g., "Bidder 123")<br>- Bid timestamp<br>- `isOwnBid` flag for current user.                |
| **(3)**     | **BR-03** | **Processing Rule (Privacy Protection):**<br>System masks bidder identities in `newBid` notification.<br>System includes `isOwnBid` boolean for front-end to highlight user's own bids.<br>Full bidder details are hidden from other participants. |
| **(4)**     | **BR-04** | **Processing Rule (Targeted Broadcast):**<br>System broadcasts `newBid` event to clients in auction-specific room only.<br>System ensures near real-time delivery for competitive bidding environment.                                             |
| **(5)-(8)** | **BR-05** | **Displaying Rule (UI Update):**<br>Client receives `newBid` event via WebSocket.<br>Client updates UI: highest bid display, bid history list, visual indication of new bid.<br>User observes new highest bid in real-time.                        |
