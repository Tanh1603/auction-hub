# 3.6.3 Override Auction Status

## 1. Use Case Description

| Field              | Description                                                                                                                                                                                                              |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Name**           | Override Auction Status                                                                                                                                                                                                  |
| **Description**    | This use case allows the Admin to override an Auction's status in the system. This is a "break-glass" feature for correcting errors (e.g., accidentally setting an auction live too early, or reverting a cancellation). |
| **Actor**          | Admin, Super Admin                                                                                                                                                                                                       |
| **Trigger**        | When the Admin selects "Override Status" in the management dashboard, selects a new status, and submits `POST /auction-finalization/override`.                                                                           |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account and has `admin` or `super_admin` role.                                                                                    |
| **Post-condition** | The Auction's status is updated to the manually specified value and an `STATUS_OVERRIDE` audit log entry is created in the system.                                                                                       |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "AuctionManagementPage" as View
control "FinalizationController" as Controller
control "FinalizationService" as Service
entity "AuctionRepository" as AuctionRepo
entity "AuditLogRepository" as AuditLogRepo

User -> View: Force Change Status (with Reason)
View -> Controller: POST /auction-finalization/override\n{ auctionId, newStatus, reason }
activate Controller

Controller -> Service: overrideStatus(auctionId, newStatus, reason, userId)
activate Service

Service -> Service: Validate Permissions & Reason
note right: BR-01, BR-03

Service -> Service: Start Transaction
Service -> AuctionRepo: update(auctionId, { status: newStatus })
activate AuctionRepo
AuctionRepo --> Service: UpdatedAuction
deactivate AuctionRepo
Service -> AuditLogRepo: create({ action: 'STATUS_OVERRIDE', reason: reason, ... })
activate AuditLogRepo
AuditLogRepo --> Service: NewAuditLog
deactivate AuditLogRepo
Service -> Service: Commit Transaction

Service --> Controller: SuccessResponse
Controller --> View: 200 OK (Status Overridden)
View --> User: Show Updated Status
deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Select Auction;
:(2) Choose New Status;
:(3) Input Reason for Override;
:(4) Submit Request;

|FinalizationService|
:(5) Authenticate & Authorize;
note right: BR-01

if (Reason Provided?) then (No)
    :(6.1) Return 400 Bad Request;
    note right: BR-03
    |Admin|
    :(6.2) View Error Message;
    stop
endif

|FinalizationService|
:(7) BEGIN TRANSACTION;

|AuctionRepository|
:(8) Update Auction Status;

|AuditLogRepository|
:(9) Log 'STATUS_OVERRIDE' Action;
note right: BR-02

|FinalizationService|
:(10) COMMIT TRANSACTION;

:(11) Return Success;

|Admin|
:(12) View New Status;
stop
@enduml
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                              |
| :---------- | :-------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)-(2)** | **BR-01** | **Displaying Rule (Auction Management Page):**<br>When Admin selects "Override Status", system displays status override modal/form.<br>System displays dropdown with available status options.<br>System displays mandatory reason text input field.                                     |
| **(3)**     | **BR-02** | **Validation Rule (Input - Front-end):**<br>When Admin selects new status, system uses `Selection_change()` method.<br>When Admin enters override reason, system uses `Text_change()` method.<br>If `isEmpty(reason)`:<br>$\rightarrow$ System displays MSG 1 ("Reason is mandatory").   |
| **(4)**     | **BR-03** | **Validation Rule (Confirmation - Front-end):**<br>On submit, system displays MSG 11 ("Are you sure you want to override status? This is an administrative action.").<br>System waits for confirmation.                                                                                  |
| **(5)**     | **BR-04** | **Validation Rule (Authorization - Back-end):**<br>System checks if requestor role is `admin` or `super_admin` in `USERS` table.<br>Only privileged users can execute this "break-glass" function.<br>If unauthorized:<br>$\rightarrow$ System displays MSG 5 ("Forbidden") on the View. |
| **(8)**     | **BR-05** | **Storing Rule:**<br>System saves to `AUCTION` table:<br>- `status = [selected new status]`                                                                                                                                                                                              |
| **(9)**     | **BR-06** | **Storing Rule (Audit Log - Mandatory):**<br>System creates record in `AUCTION_AUDIT_LOG` table:<br>- `action = 'STATUS_OVERRIDE'`<br>- `reason = [input reason]`<br>- `adminId = [current user]`<br>- `previousStatus = [old status]`<br>- `newStatus = [new status]`                   |
| **(12)**    | **BR-07** | **Displaying Rule (Success Confirmation):**<br>System displays MSG 7 ("Status override applied successfully") on the View.<br>System refreshes auction status display.                                                                                                                   |
