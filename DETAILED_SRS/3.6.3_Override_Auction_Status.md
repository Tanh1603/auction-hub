# 3.6.3 Override Auction Status

## 1. Use Case Description

| Field              | Description                                                                                                                                                                                                              |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Name**           | Override Auction Status                                                                                                                                                                                                  |
| **Description**    | This use case allows the Admin to override an Auction's status in the system. This is a "break-glass" feature for correcting errors (e.g., accidentally setting an auction live too early, or reverting a cancellation). |
| **Actor**          | Admin, Super Admin                                                                                                                                                                                                       |
| **Trigger**        | When the Admin selects "Override Status" in the management dashboard, selects a new status, and submits `POST /auction-finalization/override`.                                                                           |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account and has `admin` or `super_admin` role.                                                                                    |
| **Post-condition** | The Auction's status is updated to the manually specified value and an `STATUS_OVERRIDE` audit log entry is created in the system.                                                                                       |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "AuctionManagementPage" as View
control "FinalizationController" as Controller
control "FinalizationService" as Service
entity "AuctionRepository" as AuctionRepo
entity "AuditLogRepository" as AuditLogRepo

User -> View: Force Change Status (with Reason)
View -> Controller: POST /auction-finalization/override\n{ auctionId, newStatus, reason }
activate Controller

Controller -> Service: overrideStatus(auctionId, newStatus, reason, userId)
activate Service

Service -> Service: Validate Permissions & Reason
note right: BR-01, BR-03

Service -> Service: Start Transaction
Service -> AuctionRepo: update(auctionId, { status: newStatus })
activate AuctionRepo
AuctionRepo --> Service: UpdatedAuction
deactivate AuctionRepo
Service -> AuditLogRepo: create({ action: 'STATUS_OVERRIDE', reason: reason, ... })
activate AuditLogRepo
AuditLogRepo --> Service: NewAuditLog
deactivate AuditLogRepo
Service -> Service: Commit Transaction

Service --> Controller: SuccessResponse
Controller --> View: 200 OK (Status Overridden)
View --> User: Show Updated Status
deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Select Auction;
:(2) Choose New Status;
:(3) Input Reason for Override;
:(4) Submit Request;

|FinalizationService|
:(5) Authenticate & Authorize;
note right: BR-01

if (Reason Provided?) then (No)
    :(6.1) Return 400 Bad Request;
    note right: BR-03
    |Admin|
    :(6.2) View Error Message;
    stop
endif

|FinalizationService|
:(7) BEGIN TRANSACTION;

|AuctionRepository|
:(8) Update Auction Status;

|AuditLogRepository|
:(9) Log 'STATUS_OVERRIDE' Action;
note right: BR-02

|FinalizationService|
:(10) COMMIT TRANSACTION;

:(11) Return Success;

|Admin|
:(12) View New Status;
stop
@enduml
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :---------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)-(2)** | **BR-01** | **Displaying Rules:**<br>❖ The system displays an “OverrideStatusModal” via `Display_Modal()`.<br>❖ It renders a dropdown for selecting the [NewStatus].<br>❖ A mandatory [Reason] text area is displayed for the Admin to justify the override.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **(3)**     | **BR-02** | **Validation Rules (Front-end):**<br>❖ As the Admin enters the reason, the system performs `ValidateInput(reason)`.<br>❖ If the input is not valid:<br>⮚ If the [reason] is empty, the system disables the [Submit] button and displays **MSG 1** (Mandatory Field).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **(4)**     | **BR-03** | **Validation Rules (Confirmation):**<br>❖ When the Admin submits the form, the system triggers a confirmation modal via `Display_Modal('ConfirmationBox')`.<br>❖ It displays **MSG 11** ("Confirm status override? This is an administrative action."), awaiting explicit confirmation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(5)**     | **BR-04** | **Authorization Rules (Back-end):**<br>❖ The system calls `FinalizationService.overrideStatus()` and verifies the user's role.<br>❖ If the input is not valid:<br>⮚ If the user is not an 'admin' or 'super_admin', the system returns a 403 Forbidden status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **(8)**     | **BR-05** | **Storing Rules (Back-end):**<br>❖ The system updates the “AUCTION” table by calling `AuctionRepository.update()`.<br>❖ It sets the [status] field to the selected [newStatus].<br>❖ It ensures that the [status] is a valid enum value before saving.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **(9)**     | **BR-06** | **Audit Rules (Back-end):**<br>❖ The system records the action via `AuditLogRepository.create()`.<br>❖ It inserts a new record into “AUCTION_AUDIT_LOG” containing:<br>  - [action] = 'STATUS_OVERRIDE'<br>  - [reason] = the input reason<br>  - [previousStatus] = the old status<br>  - [newStatus] = the new status<br>  - [adminId] = the user ID.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(12)**    | **BR-07** | **Displaying Rules (Success):**<br>❖ The system refreshes the page via `Refresh_Page('AuctionDetails')`.<br>❖ It displays **MSG 7** ("Status override applied") to confirm the change.<br>❖ The Status Badge on the UI is updated immediately to reflect the new status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
