# 3.4.7 Get Registration for Auction

## 1. Use Case Description

| Field              | Description                                                                                                   |
| ------------------ | ------------------------------------------------------------------------------------------------------------- |
| **Name**           | Get Registration for Auction                                                                                  |
| **Description**    | This use case allows the Bidder to view their registration status for a specific auction.                     |
| **Actor**          | Bidder                                                                                                        |
| **Trigger**        | When Bidder navigates to an auction page or requests `GET /register-to-bid/auctions/:auctionId/registration`. |
| **Pre-condition**  | • Bidder's device must be connected to the internet.<br>• Bidder is signed in with their account.             |
| **Post-condition** | The registration status for the specific auction is displayed to the Bidder.                                  |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder" as User
boundary "AuctionDetailPage" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
entity "ParticipantRepository" as ParticipantRepo

User -> View: View Auction Page
View -> Controller: GET /register-to-bid/auctions/:auctionId/registration
activate Controller

Controller -> Service: getRegistrationForAuction(userId, auctionId)
activate Service

Service -> ParticipantRepo: findOne({ auctionId, userId })
activate ParticipantRepo
ParticipantRepo --> Service: ParticipantEntity (or null)
deactivate ParticipantRepo

alt Registration Found
    Service --> Controller: ParticipantDto
    Controller --> View: 200 OK (ParticipantDto)
    View --> User: Display Registration Status
else Registration Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display "Not Registered" UI
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Bidder|
start
:(1) Navigate to Auction Page;

|RegistrationController|
:(2) Extract User ID from JWT;
:(3) Validate Auction ID;

|RegistrationService|
:(4) Query Registration by User + Auction;

|ParticipantRepository|
:(5) Execute Database Query;
note right: BR-01

|RegistrationService|
if (Registration Found?) then (No)
    :(6.1) Return 404 Not Found;
    note right: BR-02
    |Bidder|
    :(6.2) View "Register" Button;
    stop
else (Yes)
    :(7) Map to Response DTO;
endif

:(8) Return Registration Details;

|Bidder|
:(9) View Registration Status;
:(10) (Pending/Verified/Approved/Rejected);
stop
@enduml
```

## 4. Business Rules

| Activity  | BR Code   | Description                                                                                                                                                                                                                                                                                                             |
| :-------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**   | **BR-01** | **Displaying Rule:**<br><br>Function: `Display_View('AuctionDetailPage', auction)`<br><br>Logic:<br>Render [Register] button if not registered.<br>Render [RegistrationStatus] badge if registered.                                                                                                                   |
| **(2)**   | **BR-02** | **Processing Rule (User ID):**<br><br>Function: `AuthService.getUserIdFromToken()`<br><br>Logic:<br>Extract `userId` from validated JWT token.<br>Automatically use this `userId` for query.                                                                                                                           |
| **(5)**   | **BR-03** | **Querying Rule:**<br><br>Function: Call `RegistrationService.getRegistrationForAuction(userId, auctionId)`<br><br>Logic:<br>Query `AUCTION_PARTICIPANT` table WHERE [userId] AND [auctionId] match.<br>Select: [status], [submittedAt], [documentsVerifiedAt], [depositPaidAt], [confirmedAt], [checkedInAt].        |
| **(6.1)** | **BR-04** | **Not Found Handling Rule:**<br><br>Function: `Return_404_NotFound()`<br><br>Logic:<br>IF No Record Found THEN<br>  Return HTTP 404.<br>  Frontend renders "Not Registered" state and "Register" button.<br>END IF                                                                                                        |
| **(9)**   | **BR-05** | **Displaying Rule (Status Logic):**<br><br>Function: `Display_StatusBadge(participant)`<br><br>Logic:<br>IF [participant.status] == 'FINAL_APPROVED' THEN 'Approved'<br>ELSE IF [participant.status] == 'DOCUMENTS_VERIFIED' THEN 'Documents Verified'<br>ELSE IF [participant.status] == 'DOCUMENTS_PENDING' THEN 'Pending Docs'<br>ELSE IF [participant.status] == 'REJECTED' THEN 'Rejected'<br>END IF |
