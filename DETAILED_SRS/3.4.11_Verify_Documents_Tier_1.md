# 3.4.11 Verify Documents (Tier 1)

## 1. Use Case Description

| Field              | Description                                                                                                                      |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Verify Documents (Tier 1)                                                                                                        |
| **Description**    | This use case allows the Admin to update existing Registration Document information in the system.                               |
| **Actor**          | Admin                                                                                                                            |
| **Trigger**        | When the Admin clicks on the 'Verify Documents' button on the DocumentVerificationPage.                                          |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                                  |
| **Post-condition** | The Registration Document information will be updated in the system and display new record on DocumentVerificationPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin" as User
boundary "DocumentVerificationPage" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
entity "ParticipantRepository" as ParticipantRepo

User -> View: Review Submitted Documents
User -> View: Click "Verify Documents"
View -> Controller: POST /register-to-bid/admin/verify-documents\n{ auctionId, userId }
activate Controller

Controller -> Service: verifyDocuments(auctionId, userId)
activate Service

Service -> ParticipantRepo: findParticipant(auctionId, userId)
activate ParticipantRepo
ParticipantRepo --> Service: ParticipantEntity
deactivate ParticipantRepo

alt Participant Not Found or Wrong Status
    Service --> Controller: Throw NotFound/BadRequest
    Controller --> View: 404/400 Error
    View --> User: Display Error Message
else Found and Correct Status
    ' FIX: Message text combined into one line; \n used for visual formatting
    Service -> ParticipantRepo: updateParticipant({ status: 'DOCUMENTS_VERIFIED', \ndocumentsVerifiedAt: now() })
    activate ParticipantRepo
    ParticipantRepo --> Service: UpdatedParticipant
    deactivate ParticipantRepo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (Documents Verified)
    View --> User: Display Success Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin|
start
:(1) Review Bidder Documents;
:(2) Decide to Verify;

|RegistrationService|
:(3) Authenticate & Authorize;
note right: BR-01

:(4) Retrieve Participant Record;

|ParticipantRepository|
:(5) Query Participant;

|RegistrationService|
if (Record Exists?) then (No)
    :(6.1) Return 404 Not Found;
    |Admin|
    :(6.2) View Error Message;
    stop
endif

if (Current Status is DOCUMENTS_PENDING?) then (No)
    :(7.1) Return 400 Bad Request\n(Already verified or wrong state);
    note right: BR-02
    |Admin|
    :(7.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(8) Set documentsVerifiedAt Timestamp;
:(9) Update Status to DOCUMENTS_VERIFIED;
note right: BR-03

|RegistrationService|
:(10) Trigger Notification (To Bidder for Deposit);
note right: BR-04
:(11) Return Success;

|Admin|
:(12) View Updated Status;
stop
@enduml
```

## 4. Business Rules

| Activity      | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :------------ | :-------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**       | **BR-01** | **Displaying Rules:**<br>❖ The system renders a “DocumentVerificationPage” screen via `Display_View(participant)`. (Refer to “DocumentVerificationPage” view in “View Description” file).<br>❖ The screen displays the bidder's submitted documents (e.g., identity, tax forms), along with [Verify Documents] and [Reject Documents] buttons.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **(2)**       | **BR-02** | **Validation Rules (Front-end):**<br>❖ When the Admin clicks the “Verify Documents” button, the system displays a confirmation modal, `Display_Modal('ConfirmationBox')`.<br>❖ It presents **MSG 11** ("Confirm document verification?"), awaiting the Admin's explicit confirmation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **(3)**       | **BR-03** | **Authorization Rules (Back-end):**<br>❖ The system checks the authenticated user's role via `RegistrationService.verifyDocuments()` to ensure they have the necessary permissions.<br>❖ If the input is not valid:<br>⮚ If the user's role is not 'admin' or 'auctioneer', the system returns a 403 Forbidden status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **(7.1)**     | **BR-04** | **State Locking Rules (Back-end):**<br>❖ The system verifies the current status of the participant record.<br>❖ If the input is not valid:<br>⮚ If the [status] is not 'DOCUMENTS_PENDING', the system returns a 400 Bad Request.<br>⮚ The system displays **MSG 16** (Invalid status for this operation) to the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **(8)**       | **BR-05** | **Storing Rules (Back-end):**<br>❖ Upon successful validation, the system updates the record in the “AUCTION_PARTICIPANT” table by setting the [status] to 'DOCUMENTS_VERIFIED'.<br>❖ The `documentsVerifiedAt` timestamp is recorded to the current time.<br>❖ The system triggers a notification to the bidder to proceed with the deposit payment (Tier 2).<br>❖ System moves to step (12) and displays successful notification (Refer to **MSG 7**).                                                                                                                                                                                                                                                                                                                                                      |
