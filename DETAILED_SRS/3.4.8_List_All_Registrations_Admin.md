# 3.4.7 List All Registrations (Admin)

## 1. Use Case Description

| Field              | Description                                                                                                              |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| **Name**           | List All Registrations (Admin)                                                                                           |
| **Description**    | This use case allows the Admin to search Registration information in the system based on input keywords.                 |
| **Actor**          | Admin                                                                                                                    |
| **Trigger**        | When Admin enters searching keywords in the SearchBox on the top left of the RegistrationDashboard screen.               |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                          |
| **Post-condition** | The datagrid of Registration information will be filtered by keywords and displayed on the RegistrationDashboard screen. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin/Auctioneer" as User
boundary "RegistrationDashboard" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
entity "ParticipantRepository" as ParticipantRepo

User -> View: Request All Registrations (with filters/pagination)
View -> Controller: GET /register-to-bid/admin/registrations
activate Controller

Controller -> Service: listAllRegistrations(query: ListRegistrationsDto)
activate Service

Service -> Service: Build Query\n(Where, OrderBy, Skip, Take, Includes)
note right: BR-02, BR-03, BR-04

Service -> ParticipantRepo: findMany({ where, ... })
activate ParticipantRepo
ParticipantRepo --> Service: ParticipantEntity[]
deactivate ParticipantRepo

Service -> ParticipantRepo: count({ where })
activate ParticipantRepo
ParticipantRepo --> Service: totalCount
deactivate ParticipantRepo

Service --> Controller: PaginatedResponseDto<Participant>
deactivate Service

Controller --> View: 200 OK (JSON)
deactivate Controller

View --> User: Display Table of Registrations
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin/Auctioneer|
start
:(1) Request List of Registrations;
:(2) (Optional) Apply Filters (Auction, Bidder, Status);

|RegistrationService|
:(3) Authenticate Requestor;
:(4) Authorize Requestor;
note right: BR-01

:(5) Validate Query Parameters;

:(6) Construct Database Query for Auction Participants;
note right: BR-02, BR-03, BR-04

|ParticipantRepository|
:(7) Execute Query to Retrieve Participants;
:(8) Execute Query to Count Total;

|RegistrationService|
:(9) Format Response with Pagination;
:(10) Return JSON List;

|Admin/Auctioneer|
:(11) View All Registrations;
stop
@enduml
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                                                                       |
| :---------- | :-------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)-(2)** | **BR-01** | **Displaying Rule (Registration Dashboard):**<br>When Admin/Auctioneer navigates to registration management, system displays `RegistrationDashboard`.<br>System displays filter controls: `Auction`, `Bidder`, `Status` dropdowns.<br>System displays pagination controls: `Page`, `Items per page`.                              |
| **(2)**     | **BR-02** | **Validation Rule (Filter Input - Front-end):**<br>When user selects filter options, system uses `Selection_change()` method.<br>When user enters bidder search text, system uses `Text_change()` method.<br>System validates filter parameters before sending query.                                                             |
| **(3)-(4)** | **BR-03** | **Validation Rule (Authorization - Back-end):**<br>System checks if user role is `admin` or `auctioneer` in `USERS` table.<br>If unauthorized:<br>$\rightarrow$ System displays MSG 5 ("Forbidden") on the View.<br>If `auctioneer`, system automatically scopes query to their managed auctions.                                 |
| **(6)-(8)** | **BR-04** | **Querying Rule:**<br>System retrieves data from the 'AUCTION_PARTICIPANT' table in the database (Refer to 'AUCTION_PARTICIPANT' table in 'DB Sheet' file) based on the applied filters.<br>System retrieves related User and Auction information to enrich data.<br>System applies pagination controls and counts total records. |
| **(11)**    | **BR-05** | **Displaying Rule (Results Table):**<br>System displays results in data table showing: Bidder Name, Auction Code, Status, Registration Date, Actions.<br>System displays pagination info: "Showing X-Y of Z registrations".<br>If no results found, system displays MSG 19 ("No registrations found").                            |
