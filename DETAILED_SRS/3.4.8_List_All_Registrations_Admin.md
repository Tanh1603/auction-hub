# 3.4.7 List All Registrations (Admin)

## 1. Use Case Description

| Field              | Description                                                                                                              |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| **Name**           | List All Registrations (Admin)                                                                                           |
| **Description**    | This use case allows the Admin to search Registration information in the system based on input keywords.                 |
| **Actor**          | Admin                                                                                                                    |
| **Trigger**        | When Admin enters searching keywords in the SearchBox on the top left of the RegistrationDashboard screen.               |
| **Pre-condition**  | • Admin's device must be connected to the internet.<br>• Admin is signed in with their account.                          |
| **Post-condition** | The datagrid of Registration information will be filtered by keywords and displayed on the RegistrationDashboard screen. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Admin/Auctioneer" as User
boundary "RegistrationDashboard" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
entity "ParticipantRepository" as ParticipantRepo

User -> View: Request All Registrations (with filters/pagination)
View -> Controller: GET /register-to-bid/admin/registrations
activate Controller

Controller -> Service: listAllRegistrations(query: ListRegistrationsDto)
activate Service

Service -> Service: Build Query\n(Where, OrderBy, Skip, Take, Includes)
note right: BR-02, BR-03, BR-04

Service -> ParticipantRepo: findMany({ where, ... })
activate ParticipantRepo
ParticipantRepo --> Service: ParticipantEntity[]
deactivate ParticipantRepo

Service -> ParticipantRepo: count({ where })
activate ParticipantRepo
ParticipantRepo --> Service: totalCount
deactivate ParticipantRepo

Service --> Controller: PaginatedResponseDto<Participant>
deactivate Service

Controller --> View: 200 OK (JSON)
deactivate Controller

View --> User: Display Table of Registrations
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Admin/Auctioneer|
start
:(1) Request List of Registrations;
:(2) (Optional) Apply Filters (Auction, Bidder, Status);

|RegistrationService|
:(3) Authenticate Requestor;
:(4) Authorize Requestor;
note right: BR-01

:(5) Validate Query Parameters;

:(6) Construct Database Query for Auction Participants;
note right: BR-02, BR-03, BR-04

|ParticipantRepository|
:(7) Execute Query to Retrieve Participants;
:(8) Execute Query to Count Total;

|RegistrationService|
:(9) Format Response with Pagination;
:(10) Return JSON List;

|Admin/Auctioneer|
:(11) View All Registrations;
stop
@enduml
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :---------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)-(2)** | **BR-01** | **Displaying Rules:**<br>❖ The system renders the “RegistrationDashboard” screen via `Display_View()`.<br>❖ It displays filter controls including [AuctionId] (dropdown), [BidderName] (text input), and [Status] (dropdown).<br>❖ The system renders a paginated data table with columns: Bidder, Auction, Status, SubmittedAt, and Actions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **(2)**     | **BR-02** | **Validation Rules (Front-end):**<br>❖ The system validates filter inputs using `ValidateFilterInput(filterDto)`.<br>❖ It ensures that selected filter values are valid (e.g., [AuctionId] must be a valid UUID).<br>❖ It also verifies that pagination parameters (page, limit) are positive integers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **(3)-(4)** | **BR-03** | **Authorization Rules (Back-end):**<br>❖ The system checks the authenticated user's role via `RegistrationService.listAllRegistrations()`.<br>❖ If the input is not valid:<br>⮚ If the user's role is not 'admin' or 'auctioneer', the system returns a 403 Forbidden status.<br>❖ If the user is an 'auctioneer', the system automatically scopes the query to only show registrations for auctions they own.                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **(6)-(8)** | **BR-04** | **Querying Rules:**<br>❖ The system executes `ParticipantRepository.findMany(query)` to retrieve the data.<br>❖ It builds a Prisma WHERE clause applying filters for `auction.id`, `user.fullName`, and `status`.<br>❖ The query includes related `User` and `Auction` entities to populate the table.<br>❖ Pagination is applied using `skip` and `take`, and results are ordered by `submittedAt` descending.                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **(11)**    | **BR-05** | **Displaying Rules (Data Table):**<br>❖ The system renders the results via `Display_DataTable('Registrations', data, pagination)`.<br>❖ Each row displays the Bidder's Full Name, Auction Code, a colored Status Badge, and the formatted SubmittedAt date.<br>❖ An action button ("View Details") is included for each row.<br>❖ Pagination controls show the current page and total pages.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |