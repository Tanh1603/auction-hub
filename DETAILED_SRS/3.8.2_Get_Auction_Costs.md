# 3.8.2 Get Auction Costs

## 1. Use Case Description

| Field              | Description                                                                                              |
| ------------------ | -------------------------------------------------------------------------------------------------------- |
| **Name**           | Get Auction Costs                                                                                        |
| **Description**    | This use case allows the User to search Auction Costs information in the system based on input keywords. |
| **Actor**          | User                                                                                                     |
| **Trigger**        | When User clicks on the 'View Costs' button on the AuctionDetailPage screen.                             |
| **Pre-condition**  | • User's device must be connected to the internet.<br>• User is signed in with their account.            |
| **Post-condition** | The Auction Costs details will be displayed on the AuctionCostSummaryPage screen.                        |

<h2>2. Sequence Flow (MVC)</h2>

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
boundary "AuctionCostSummaryPage" as View
control "AuctionCostController" as Controller
control "AuctionCostService" as Service
database "AuctionRepository" as AuctionRepo
database "AuctionCostRepository" as CostRepo

User -> View: View Auction Cost Summary
View -> Controller: GET /auction-costs/auction/:auctionId
activate Controller

Controller -> Service: getAuctionCosts(auctionId, userId)
activate Service

Service -> AuctionRepo: findById(auctionId)
activate AuctionRepo
AuctionRepo --> Service: AuctionEntity
deactivate AuctionRepo

alt Auction Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display Error Message
else Auction Found
    Service -> CostRepo: findByAuctionId(auctionId)
    activate CostRepo
    CostRepo --> Service: AuctionCostEntity (or null)
    deactivate CostRepo

    alt Costs Not Found
        Service --> Controller: Throw NotFoundException
        Controller --> View: 404 Not Found
        View --> User: Display Error Message
    else Costs Found
        Service --> Controller: AuctionCostResponseDto
        Controller --> View: 200 OK (Costs)
        View --> User: View Costs
    end
end

deactivate Service
deactivate Controller
@endumal
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|User|
start
:(1) Request Auction Cost Details;

|AuctionCostService|
:(2) Authenticate Requestor;
note right: BR-01

|AuctionRepository|
:(3) Retrieve Auction;

|AuctionCostRepository|
:(4) Query AuctionCost by auctionId;

|AuctionCostService|
if (Costs Found?) then (No)
    :(5.1) Return 404 Not Found;
    |User|
    :(5.2) View Error Message;
    stop
endif

|AuctionCostService|
:(6) Format Response;
:(7) Return Cost Details;

|User|
:(8) View Costs;
stop
@endumal
```

## 4. Business Rules

| Activity      | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------------ | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**       | **BR-01** | **Displaying Rules:**<br>❖ The system renders an “AuctionCostSummaryPage” via `Display_View()`.<br>❖ It displays a loading indicator while the data is being retrieved.<br>❖ The cost breakdown is rendered in organized sections: Fixed Costs, Variable Costs, and Other Costs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **(2)**       | **BR-02** | **Authorization Rules (Back-end):**<br>❖ The system checks if the user is authenticated via `AuctionCostService.getAuctionCosts()`.<br>❖ If the input is not valid:<br>⮚ If the user is not authenticated, the system returns a 401 Unauthorized status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **(3)**       | **BR-03** | **Querying Rules:**<br>❖ The system calls `AuctionRepository.findById(auctionId)` to verify the auction exists.<br>❖ If the input is not valid:<br>⮚ If the auction is not found, the system returns a 404 Not Found error.<br>⮚ It displays **MSG 20** (Auction not found).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **(4)-(5.1)** | **BR-04** | **Querying Rules:**<br>❖ The system queries the “AUCTION_COST” table via `AuctionCostRepository.findByAuctionId(auctionId)`.<br>❖ If the input is not valid:<br>⮚ If no cost record is found, the system returns a 404 Not Found error.<br>⮚ It displays **MSG 20** (Costs not recorded).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **(8)**       | **BR-05** | **Displaying Rules (Data):**<br>❖ The system renders the cost details using `Display_CostBreakdown(costs)`.<br>❖ It displays values for [advertisingCost], [venueRentalCost], and [appraisalCost].<br>❖ It iterates through the `otherCosts` array to list each miscellaneous item.<br>❖ The [totalCosts] is displayed prominently at the bottom.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
