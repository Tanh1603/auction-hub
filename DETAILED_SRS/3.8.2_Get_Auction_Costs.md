# 3.8.2 Get Auction Costs

## 1. Use Case Description

| Field              | Description                                                                                              |
| ------------------ | -------------------------------------------------------------------------------------------------------- |
| **Name**           | Get Auction Costs                                                                                        |
| **Description**    | This use case allows the User to search Auction Costs information in the system based on input keywords. |
| **Actor**          | User                                                                                                     |
| **Trigger**        | When User clicks on the 'View Costs' button on the AuctionDetailPage screen.                             |
| **Pre-condition**  | • User's device must be connected to the internet.<br>• User is signed in with their account.            |
| **Post-condition** | The Auction Costs details will be displayed on the AuctionCostSummaryPage screen.                        |

<h2>2. Sequence Flow (MVC)</h2>

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
boundary "AuctionCostSummaryPage" as View
control "AuctionCostController" as Controller
control "AuctionCostService" as Service
database "AuctionRepository" as AuctionRepo
database "AuctionCostRepository" as CostRepo

User -> View: View Auction Cost Summary
View -> Controller: GET /auction-costs/auction/:auctionId
activate Controller

Controller -> Service: getAuctionCosts(auctionId, userId)
activate Service

Service -> AuctionRepo: findById(auctionId)
activate AuctionRepo
AuctionRepo --> Service: AuctionEntity
deactivate AuctionRepo

alt Auction Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display Error Message
else Auction Found
    Service -> CostRepo: findByAuctionId(auctionId)
    activate CostRepo
    CostRepo --> Service: AuctionCostEntity (or null)
    deactivate CostRepo

    alt Costs Not Found
        Service --> Controller: Throw NotFoundException
        Controller --> View: 404 Not Found
        View --> User: Display Error Message
    else Costs Found
        Service --> Controller: AuctionCostResponseDto
        Controller --> View: 200 OK (Costs)
        View --> User: View Costs
    end
end

deactivate Service
deactivate Controller
@endumal
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|User|
start
:(1) Request Auction Cost Details;

|AuctionCostService|
:(2) Authenticate Requestor;
note right: BR-01

|AuctionRepository|
:(3) Retrieve Auction;

|AuctionCostRepository|
:(4) Query AuctionCost by auctionId;

|AuctionCostService|
if (Costs Found?) then (No)
    :(5.1) Return 404 Not Found;
    |User|
    :(5.2) View Error Message;
    stop
endif

|AuctionCostService|
:(6) Format Response;
:(7) Return Cost Details;

|User|
:(8) View Costs;
stop
@endumal
```

## 4. Business Rules

| Activity      | BR Code   | Description                                                                                                                                                                                                                                                                                                  |
| :------------ | :-------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**       | **BR-01** | **Displaying Rule (Auction Cost Summary Page):**<br>When User navigates to auction cost summary, system displays `AuctionCostSummaryPage`.<br>System shows loading indicator while fetching cost data.                                                                                                       |
| **(2)**       | **BR-02** | **Validation Rule (Authentication - Back-end):**<br>System verifies requestor is authenticated.<br>If not authenticated:<br>$\rightarrow$ System displays MSG 5 ("Authentication required") on the View.                                                                                                     |
| **(3)**       | **BR-03** | **Validation Rule (Auction Existence - Back-end):**<br>System retrieves data from the 'AUCTION' table in the database (Refer to 'AUCTION' table in 'DB Sheet' file) based on the auction ID to verify it exists.<br>If not found:<br>$\rightarrow$ System displays MSG 20 ("Auction not found") on the View. |
| **(4)-(5.1)** | **BR-04** | **Querying Rule:**<br>System retrieves data from the 'AUCTION_COST' table in the database (Refer to 'AUCTION_COST' table in 'DB Sheet' file) based on the auction ID.<br>If no cost record found:<br>$\rightarrow$ System displays MSG 20 ("Costs not recorded for this auction") on the View.               |
| **(8)**       | **BR-05** | **Displaying Rule (Cost Breakdown):**<br>System displays cost details showing:<br>- Individual cost categories (advertising, venue, appraisal, etc.)<br>- Other costs list (description and amount for each)<br>- Calculated total costs.                                                                    |
