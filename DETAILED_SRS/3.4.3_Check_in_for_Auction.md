# 3.4.3 Check-in for Auction

## 1. Use Case Description

| Field              | Description                                                                                                                      |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Check-in for Auction                                                                                                             |
| **Description**    | This use case allows the Bidder to update existing Auction Registration information in the system.                               |
| **Actor**          | Bidder                                                                                                                           |
| **Trigger**        | When the Bidder clicks on the 'Check In' button on the AuctionCheckInPage.                                                       |
| **Pre-condition**  | • Bidder's device must be connected to the internet.<br>• Bidder is signed in with their account.                                |
| **Post-condition** | The Auction Registration information will be updated in the system and display checked-in status on AuctionCheckInPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder" as User
boundary "AuctionCheckInPage" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
database "ParticipantRepository" as ParticipantRepo
database "AuctionRepository" as AuctionRepo

User -> View: Click "Check In"
View -> Controller: POST /register-to-bid/check-in\n{ auctionId }
activate Controller

Controller -> Service: checkIn(auctionId, userId)
activate Service

Service -> ParticipantRepo: findParticipantAndAuction(auctionId, userId)
activate ParticipantRepo
ParticipantRepo --> Service: Participant & Auction
deactivate ParticipantRepo

Service -> Service: Validate Conditions
note right: BR-02, BR-03

alt Not Approved or Outside Window
    Service --> Controller: Throw Forbidden/BadRequest
    Controller --> View: 403/400 Error
    View --> User: Display Error Message
else Conditions Met
    Service -> ParticipantRepo: update({ checkedInAt: now() })
    activate ParticipantRepo
    ParticipantRepo --> Service: UpdatedParticipant
    deactivate ParticipantRepo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (Checked In)
    View --> User: Receive Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Bidder|
start
:(1) Request Check-in;

|RegistrationService|
:(2) Authenticate Requestor;
:(3) Retrieve Registration Status;

|ParticipantRepository|
:(4) Query Participant and Auction;

|RegistrationService|
if (Registration Approved?) then (No)
    :(5.1) Return 403 Forbidden\n(Registration Incomplete);
    note right: BR-02
    |Bidder|
    :(5.2) View Error Message;
    stop
endif

|RegistrationService|
:(6) Calculate Check-in Window;
:(7) Compare with Current Time;
note right: BR-03

if (Within Window?) then (No)
    :(8.1) Return 400 Bad Request\n(Window Closed/Not Open);
    |Bidder|
    :(8.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(9) Update checkedInAt Timestamp;

|RegistrationService|
:(10) Return Success;

|Bidder|
:(11) Receive Confirmation;
:(12) Access Bidding Interface;
stop
@enduml
```

## 4. Business Rules

| Activity  | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :-------- | :-------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**   | **BR-01** | **Querying Rule:**<br>System queries data in the table 'AUCTION_PARTICIPANT' in the database (Refer to 'AUCTION_PARTICIPANT' table in 'DB Sheet' file) based on the auction ID and user ID.<br>Call method `displayRegistrationStatus(registration)` to show approval status.                                                                                                                                                                                   |
| **(1)**   | **BR-02** | **Displaying Rule:**<br>The system displays a 'AuctionCheckInPage' screen. (Refer to 'AuctionCheckInPage' view in 'View Description' file).<br>Screen shows registration status, auction time, and 'Check In' button (enabled only if approved).                                                                                                                                                                                                                |
| **(5.1)** | **BR-03** | **Validation Rule (Front-end):**<br>System checks registration status before enabling Check In button.<br>If status != 'FINAL_APPROVED' → disable button, display **MSG 19** (Registration incomplete).                                                                                                                                                                                                                                                         |
| **(7)**   | **BR-04** | **Validation Rule (Time Window):**<br>System calculates check-in window (e.g., 30 mins before to 15 mins after auctionStartAt).<br>If current time outside window → display **MSG 20** (Check-in window closed/not open).                                                                                                                                                                                                                                       |
| **(9)**   | **BR-05** | **Validation Rule (Back-end/Save):**<br>When user clicks 'Check In' button, send data via function `checkIn(auctionId, userId)`.<br>The Participant information will be updated in table 'AUCTION_PARTICIPANT' in the database (Refer to 'AUCTION_PARTICIPANT' table in 'DB Sheet' file) to set the check-in timestamp.<br>If already checked in → gracefully handle (no duplicate update).<br>Else, show **MSG 7** (Success), enable bidding interface access. |
