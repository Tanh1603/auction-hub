# 3.4.3 Check-in for Auction

## 1. Use Case Description

| Field              | Description                                                                                                                      |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Check-in for Auction                                                                                                             |
| **Description**    | This use case allows the Bidder to update existing Auction Registration information in the system.                               |
| **Actor**          | Bidder                                                                                                                           |
| **Trigger**        | When the Bidder clicks on the 'Check In' button on the AuctionCheckInPage.                                                       |
| **Pre-condition**  | • Bidder's device must be connected to the internet.<br>• Bidder is signed in with their account.                                |
| **Post-condition** | The Auction Registration information will be updated in the system and display checked-in status on AuctionCheckInPage datagrid. |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Bidder" as User
boundary "AuctionCheckInPage" as View
control "RegistrationController" as Controller
control "RegistrationService" as Service
database "ParticipantRepository" as ParticipantRepo
database "AuctionRepository" as AuctionRepo

User -> View: Click "Check In"
View -> Controller: POST /register-to-bid/check-in\n{ auctionId }
activate Controller

Controller -> Service: checkIn(auctionId, userId)
activate Service

Service -> ParticipantRepo: findParticipantAndAuction(auctionId, userId)
activate ParticipantRepo
ParticipantRepo --> Service: Participant & Auction
deactivate ParticipantRepo

Service -> Service: Validate Conditions
note right: BR-02, BR-03

alt Not Approved or Outside Window
    Service --> Controller: Throw Forbidden/BadRequest
    Controller --> View: 403/400 Error
    View --> User: Display Error Message
else Conditions Met
    Service -> ParticipantRepo: update({ checkedInAt: now() })
    activate ParticipantRepo
    ParticipantRepo --> Service: UpdatedParticipant
    deactivate ParticipantRepo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (Checked In)
    View --> User: Receive Confirmation
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Bidder|
start
:(1) Request Check-in;

|RegistrationService|
:(2) Authenticate Requestor;
:(3) Retrieve Registration Status;

|ParticipantRepository|
:(4) Query Participant and Auction;

|RegistrationService|
if (Registration Approved?) then (No)
    :(5.1) Return 403 Forbidden\n(Registration Incomplete);
    note right: BR-02
    |Bidder|
    :(5.2) View Error Message;
    stop
endif

|RegistrationService|
:(6) Calculate Check-in Window;
:(7) Compare with Current Time;
note right: BR-03

if (Within Window?) then (No)
    :(8.1) Return 400 Bad Request\n(Window Closed/Not Open);
    |Bidder|
    :(8.2) View Error Message;
    stop
endif

|ParticipantRepository|
:(9) Update checkedInAt Timestamp;

|RegistrationService|
:(10) Return Success;

|Bidder|
:(11) Receive Confirmation;
:(12) Access Bidding Interface;
stop
@enduml
```

## 4. Business Rules

| Activity  | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :-------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**   | **BR-01** | **Displaying Rules:**<br>❖ The system displays an “AuctionCheckInPage” screen via `Display_View(participant)`. (Refer to “AuctionCheckInPage” view in “View Description” file).<br>❖ The screen renders details about the auction and the current registration status.<br>❖ The [Check In] button is displayed, but its enabled state depends on the registration status and the current time window.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **(5.1)** | **BR-02** | **State Locking Rules (Back-end):**<br>❖ The system calls `RegistrationService.checkIn()` and verifies the participant's status in the “AUCTION_PARTICIPANT” table.<br>❖ If the input is not valid:<br>⮚ If the [status] is not 'FINAL_APPROVED', the system prevents check-in.<br>⮚ It returns a 403 Forbidden status and displays **MSG 19** (Registration incomplete).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **(7)**   | **BR-03** | **Time Window Rules (Back-end):**<br>❖ The system calculates the valid check-in window using `AuctionService.getCheckInWindow(auctionId)`.<br>❖ It retrieves `auctionStartAt`, `validCheckInBeforeStartMinutes`, and `validCheckInAfterStartMinutes`.<br>❖ If the input is not valid:<br>⮚ If the current time is not within the calculated window, the system returns a 400 Bad Request.<br>⮚ It displays **MSG 20** (Check-in window closed/not open) to the user.                                                                                                                                                                                                                                                                                                                                                                                                    |
| **(9)**   | **BR-04** | **Storing Rules (Back-end):**<br>❖ Upon successful validation, the system updates the record in the “AUCTION_PARTICIPANT” table.<br>❖ It sets the [checkedInAt] field to the current timestamp.<br>❖ System moves to step (11) and displays successful notification (Refer to **MSG 7**).<br>❖ The system then enables access to the Bidding Interface for the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |