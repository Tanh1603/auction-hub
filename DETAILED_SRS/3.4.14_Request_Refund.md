# 3.4.14 Request Refund & Auto-Refund System

## 1. Use Case Description

| Field              | Description                                                               |
| ------------------ | ------------------------------------------------------------------------- |
| **Name**           | Deposit Refund System                                                     |
| **Description**    | Handles deposit refunds for non-winning participants (automatic + manual) |
| **Actor**          | Bidder, System                                                            |
| **Pre-condition**  | • Auction is finalized<br>• Participant has paid deposit                  |
| **Post-condition** | Eligible deposit is refunded (application fee is NOT refunded)            |

> **⚠️ IMPORTANT: Deposit vs Application Fee**
>
> - **Deposit (Tiền đặt trước)**: Refundable
> - **Application Fee (Phí hồ sơ)**: **NON-REFUNDABLE**
>
> Refund = Deposit ONLY

## 2. Refund Paths

### Automatic Refund (Preferred)

Non-winners receive **automatic refund within 3 business days** after auction finalization. System scheduled job processes daily.

### Manual Request (User-Initiated)

Users can request expedited refund or for early withdrawal scenarios.

## 3. Business Rules

| BR Code   | Rule                                                            |
| :-------- | :-------------------------------------------------------------- |
| **BR-01** | Non-winners get 100% deposit refund (app fee excluded)          |
| **BR-02** | Auto-refund triggers 3 business days after auction finalization |
| **BR-03** | Withdrawal before `saleEndAt` = eligible for refund             |
| **BR-04** | Withdrawal after `saleEndAt` = deposit forfeited                |
| **BR-05** | Disqualified participants = deposit forfeited                   |
| **BR-06** | Check-in failure = deposit forfeited                            |
| **BR-07** | Bank transaction fees are participant's responsibility          |

## 4. Deposit Forfeiture Cases

| Code                  | Description                                    |
| :-------------------- | :--------------------------------------------- |
| `NO_SHOW`             | Didn't attend auction                          |
| `FALSE_INFORMATION`   | False registration info                        |
| `FORGED_DOCUMENTS`    | Forged documents                               |
| `PRICE_RIGGING`       | Price manipulation/collusion                   |
| `AUCTION_OBSTRUCTION` | Obstructed auction                             |
| `BID_WITHDRAWAL`      | Withdrew placed bid                            |
| `REFUSED_TO_SIGN`     | Refused to sign minutes (2 days deadline)      |
| `REFUSED_RESULT`      | Refused winning result                         |
| `PAYMENT_DEFAULT`     | Winner payment default (3 days after contract) |
| `CONTRACT_DEFAULT`    | Failed to sign contract (7 days)               |
| `CHECK_IN_FAILURE`    | Failed check-in before auction ends            |
| `LATE_WITHDRAWAL`     | Withdrew after `saleEndAt`                     |

## 5. API Specification

### Manual Refund Request

| Method | Endpoint                          | Body                     | Response            |
| :----- | :-------------------------------- | :----------------------- | :------------------ |
| POST   | `/register-to-bid/request-refund` | `{ auctionId, reason? }` | `RefundResponseDto` |

## 6. Response DTO

```typescript
interface RefundResponseDto {
  participantId: string;
  auctionId: string;
  depositAmount: number;
  applicationFee: number; // Non-refundable
  refundableAmount: number; // Deposit only
  refundStatus: 'pending' | 'approved' | 'rejected' | 'processed' | 'auto_processed' | 'forfeited';
  refundRequestedAt?: Date;
  eligibility: {
    eligible: boolean;
    reason: string;
  };
}
```

## 7. Refund Status Flow

```
AUTOMATIC:   Auction Ends → 3 Business Days → AUTO_PROCESSED
MANUAL:      User Request → PENDING → APPROVED → PROCESSED
FORFEITURE:  Disqualification → FORFEITED
```
