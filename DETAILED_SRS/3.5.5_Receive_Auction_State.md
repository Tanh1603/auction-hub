# 3.5.5 Receive Auction State

## 1. Use Case Description

| Field              | Description                                                                                              |
| ------------------ | -------------------------------------------------------------------------------------------------------- |
| **Name**           | Receive Auction State                                                                                    |
| **Description**    | This use case allows the User to search Auction State information in the system based on input keywords. |
| **Actor**          | User                                                                                                     |
| **Trigger**        | When the User joins an auction room via WebSocket.                                                       |
| **Pre-condition**  | • User's device must be connected to the internet.<br>• User is signed in with their account.            |
| **Post-condition** | The Auction State information will be displayed on the AuctionDetailPage screen.                         |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "User" as User
control "AuctionService" as Service
entity "AuctionRepository" as AuctionRepo
control "WebSocketGateway" as WSGateway
boundary "WebSocketClient" as WSClient
boundary "AuctionDetailPage" as View

Service -> AuctionRepo: getAuctionDetails(auctionId)
activate AuctionRepo
AuctionRepo --> Service: AuctionEntity
deactivate AuctionRepo
Service --> WSGateway: AuctionStateDto

WSGateway -> WSGateway: Broadcast `auctionState` to room (auctionId)
note right: BR-01, BR-02

WSGateway --> WSClient: Emit `auctionState` (AuctionStateDto)
WSClient -> View: Update UI with AuctionStateDto
View --> User: Display Current Auction State
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|User|
start
:Load Auction Page;

|WebSocketClient|
:Establish WebSocket Connection;
:Emit "joinAuction" Event;

|WebSocketGateway|
:(1) Auction State Change Detected / Join Event;

|AuctionService|
:(2) Retrieve Current Auction State;

|AuctionRepository|
:(3) Query Auction Data;

|WebSocketGateway|
:(4) Format State Data;
note right: BR-02, BR-04

:(5) Broadcast "auctionState" Event;
note right: BR-01

|WebSocketClient|
:(6) Receive "auctionState" Event;

|User|
:(7) Parse Auction State Data;
:(8) Update User Interface;
:(9) View Latest Auction State;
stop
@endumal
```

## 4. Business Rules

| Activity    | BR Code   | Description                                                                                                                                                                                                                                                                   |
| :---------- | :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **(1)**     | **BR-01** | **Processing Rule (State Change Trigger):**<br>System detects auction state change (join event, status transition, admin override).<br>System prepares to broadcast updated state to room subscribers.                                                                        |
| **(2)-(3)** | **BR-02** | **Querying Rule:**<br>System retrieves data from the 'AUCTION' table in the database (Refer to 'AUCTION' table in 'DB Sheet' file) to obtain current auction data.<br>System retrieves: status, current highest bid, winning bidder ID, auction end time, and starting price. |
| **(4)**     | **BR-03** | **Processing Rule (Data Filtering):**<br>System filters sensitive data from `auctionState` payload.<br>System excludes: internal IDs, admin-only fields, private bidder details.<br>System includes only public information safe for broadcast.                               |
| **(5)**     | **BR-04** | **Processing Rule (Targeted Broadcast):**<br>System broadcasts `auctionState` event to clients in auction-specific room only.<br>System ensures efficient network usage by not broadcasting to unrelated rooms.                                                               |
| **(6)-(9)** | **BR-05** | **Displaying Rule (UI Update):**<br>Client receives `auctionState` event via WebSocket.<br>Client parses data and updates UI: highest bid display, countdown timer, status indicator.<br>User observes synchronized auction state.                                            |
