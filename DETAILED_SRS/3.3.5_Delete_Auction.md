# 3.3.5 Delete Auction

## 1. Use Case Description

| Field              | Description                                                                                                                                                                         |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**           | Delete Auction                                                                                                                                                                      |
| **Description**    | This use case allows the Auctioneer/Admin to delete an existing Auction from the system.                                                                                            |
| **Actor**          | Auctioneer, Admin                                                                                                                                                                   |
| **Trigger**        | When the Auctioneer/Admin clicks on the 'Delete Auction' button and confirms deletion.                                                                                              |
| **Pre-condition**  | • Auctioneer/Admin's device must be connected to the internet.<br>• Auctioneer/Admin is signed in with their account.<br>• Auction exists and is in appropriate state for deletion. |
| **Post-condition** | The Auction and its related data are removed from the system.                                                                                                                       |

## 2. Sequence Flow (MVC)

```plantuml
@startuml
autonumber
skinparam sequenceMessageAlign center

actor "Auctioneer/Admin" as User
boundary "AuctionManagementPage" as View
control "AuctionController" as Controller
control "AuctionService" as Service
entity "AuctionRepository" as Repo

User -> View: Click Delete Auction
View -> View: Show Confirmation Dialog
note right: BR-01
View -> Controller: DELETE /auctions/:id
activate Controller

Controller -> Service: remove(id)
activate Service

Service -> Repo: findById(id)
activate Repo
Repo --> Service: AuctionEntity (or null)
deactivate Repo

alt Auction Found & Deletable
    Service -> Repo: delete(id)
    activate Repo
    Repo --> Service: Deleted
    deactivate Repo

    Service --> Controller: SuccessResponse
    Controller --> View: 200 OK (Deleted)
    View --> User: Show Success Message
else Auction Not Found
    Service --> Controller: Throw NotFoundException
    Controller --> View: 404 Not Found
    View --> User: Display Error Message
else Auction Not Deletable
    Service --> Controller: Throw BadRequestException
    Controller --> View: 400 Bad Request
    View --> User: Display Error Message
end

deactivate Service
deactivate Controller
@enduml
```

## 3. Activities Flow (Swimlanes)

```plantuml
@startuml
|Auctioneer/Admin|
start
:(1) Select Auction to Delete;
:(2) Confirm Deletion;
note right: BR-01

|AuctionController|
:(3) Authenticate & Authorize;
note right: BR-02

|AuctionService|
:(4) Verify Auction Exists;

if (Auction Found?) then (No)
    :(5.1) Return 404 Not Found;
    |Auctioneer/Admin|
    :(5.2) View Error Message;
    stop
endif

:(6) Check Auction State;
note right: BR-03

if (Deletable State?) then (No)
    :(7.1) Return 400 Bad Request;
    |Auctioneer/Admin|
    :(7.2) View Error Message;
    stop
endif

|AuctionRepository|
:(8) Delete Related Data (Cascade);
note right: BR-04
:(9) Delete Auction Record;

|AuctionService|
:(10) Return Success Response;

|Auctioneer/Admin|
:(11) View Updated Auction List;
stop
@enduml
```

## 4. Business Rules

| Activity | BR Code   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **(1)**  | **BR-01** | **Displaying Rules (Confirmation):**<br>❖ The system displays a confirmation modal, `Display_Modal('ConfirmationBox')`. (Refer to “ConfirmationBox” view in “View Description” file).<br>❖ It presents **MSG 11** ("Delete auction? Action cannot be undone.") to the Admin.<br>❖ The system awaits Admin confirmation before proceeding with the irreversible deletion.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **(3)**  | **BR-02** | **Authorization Rules (Back-end):**<br>❖ The system checks the authenticated user's role via `AuctionService.remove()` to ensure they have the necessary permissions.<br>❖ If the input is not valid:<br>⮚ If the user's role is not 'auctioneer', 'admin', or 'super_admin', the system returns a 403 Forbidden status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **(6)**  | **BR-03** | **State Locking Rules (Back-end):**<br>❖ The system verifies the auction’s status by checking the [status] field in the “AUCTION” table.<br>❖ If the input is not valid:<br>⮚ If the [status] is not 'scheduled', the system returns a 400 Bad Request.<br>⮚ The system displays a message indicating that active or ended auctions cannot be deleted.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **(8)**  | **BR-04** | **Processing Rules (Cascade Delete):**<br>❖ The system relies on database cascade rules.<br>❖ Upon deletion of the main auction record, related entries in tables such as “AUCTION_PARTICIPANT”, “AUCTION_BID”, and “AUCTION_COST” are automatically removed via foreign key constraints.<br>❖ This ensures data integrity and prevents orphaned records.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **(11)** | **BR-05** | **Storing Rules (Back-end):**<br>❖ The system removes the record from the “AUCTION” table by calling `AuctionService.remove(id)`.<br>❖ This is a hard delete, permanently removing the record.<br>❖ System moves to step (11) and displays successful notification (Refer to **MSG 7**).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |